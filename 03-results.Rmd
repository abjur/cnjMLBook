# Resultados

As análises do capítulo de resultados seguiram um roteiro de perguntas, considerando o objetivo principal da pesquisa. Em cada tribunal analisado, conduzimos as investigações respondendo às questões abaixo, na ordem em que o encadeamento das respostas foi mais natural. 

  1. Quem são os maiores litigantes?
  1. Os 30 maiores litigantes concentram qual percentual do total de processos?
  1. Sobre características dos maiores litigantes:
      - Quais são os 5 setores com maior quantidade de processos?
      - Quais são os 10 assuntos processuais mais comuns em cada setor?
      - Os volumes processuais apresentam algum tipo de padrão temporal?


O roteiro limitou-se às cifras mencionadas acima (5 setores, 10 assuntos processuais e 30 litigantes) apenas para tornar a exposição mais clara. Conforme verificado a seguir, esses números foram capazes de descrever o comportamento de grande quantidade dos processos. Mesmo assim, para os casos não comentados nesse capítulo, o apêndice contém versões menos resumidas das tabelas.

  Em alguns tribunais, os mecanismos de seleção impossibilitam análises temporais. Isso acontece porque os dados utilizados na premiação do Selo Justiça em Números não representam adequadamente os processos distribuídos em um ano. Os dados obtidos na ocasião desse prêmio representam adequadamente os processos que receberam carga e aqueles processos que estavam em aberto no momento da coleta. Por conta disso, fizemos análises temporais e conduzimos estudos prospectivos nos estados de São Paulo, Rio Grande do Sul, Amazonas e Bahia.

```{r}
if("data-raw" %in% dir(getwd())){
    knitr::opts_chunk$set(echo = F, eval = T)
  } else {
    knitr::opts_chunk$set(echo = T, eval = F)

    maiores_litigantes_tjrs <- list(p = "NÃO CALCULAREI")
    maiores_litigantes_tjsp <- list(p = "NÃO CALCULAREI")
    maiores_litigantes_tjrj <- list(p = "NÃO CALCULAREI")
    maiores_litigantes_tjmt <- list(p = "NÃO CALCULAREI")
    maiores_litigantes_tjdft <- list(p = "NÃO CALCULAREI")
    maiores_litigantes_tjam <- list(p = "NÃO CALCULAREI")
    maiores_litigantes_tjba <- list(p = "NÃO CALCULAREI")

    maiores_setores_tjrs <- list(p = "NÃO CALCULAREI")
    maiores_setores_tjsp <- list(p = "NÃO CALCULAREI")
    maiores_setores_tjrj <- list(p = "NÃO CALCULAREI")
    maiores_setores_tjmt <- list(p = "NÃO CALCULAREI")
    maiores_setores_tjdft <- list(p = "NÃO CALCULAREI")
    maiores_setores_tjam <- list(p = "NÃO CALCULAREI")
    maiores_setores_tjba <- list(p = "NÃO CALCULAREI")

    media_sem_2013 <- "NÃO CALCULAREI"
    media_com_2013 <- "NÃO CALCULAREI"
    processos_em_2013 <- "NÃO CALCULAREI"

    assuntos_bancos <- list(p = "NADA")

    telecomunicaoes <- list(p = "NADA")
    telecomunicacoes <- list(p = "NADA")
    litigantes_banco_de_dados <- list(p = "NADA")
    maiores_assuntos_banco_de_dados <- list(p = "NADA")
    assuntos_telecom <- list(p = "NADA")
    assuntos_energia <- list(p = "NADA")
    maiores_litigantes_energia <- list(p = "NADA")
    seguros <- list(p = "NADA")
    energia <- list(p = "NADA")
  }
```

```{r}
  library(tidyverse)
  library(tidyML)
  library(stringr)

  control_table <- tpur::control_table
  tpu <- readRDS("data-raw/tpu.rds")
  l_tpu <- readRDS("data-raw/l_tpu.rds")

  assuntos_consumeristas_tpu <- readRDS("data-raw/assuntos_consumeristas_tpu.rds")

  codigos_consumeristas_puros <- assuntos_consumeristas_tpu$codigo

    #especifico tjrs
    {especifico_tjrs <- c("Abatimento proporcional do preço",
                                "Cadastro de Análise de Crédito",
                                "Cobrança indevida de ligações ",
                                "Cobrança Indevida de Serviços",
                                "Comercialização de dados cadastrais de consumidores",
                                "Contratos de Participacao Financeira",
                                "Medicamento / Tratamento / Cirurgia de Eficácia não comprovada",
                                "Metodologia de Reajuste de Tarifa - IRT",
                                "Notificação",
                                "Registro em Cadastro de Análise de Crédito",
                                "Registro em Cadastro",
                                "Registro em Cadastro de Inadimplentes",
                                "Registro para comercialização de dados cadastrais de consumidores",
                                "Reparação de Danos")}

  assuntos_consumeristas_puros <- l_tpu %>%
    dplyr::filter(codigo %in% codigos_consumeristas_puros) %>%
    with(assunto) %>%
    c(especifico_tjrs) %>%
    unique

  #d_tjrs <- read_rds('data-raw/tjrs_filtrado_final.rds')

  # d_tjrs_2 <- d_tjrs %>%
  #   mutate(nome2 = aggregate_major_companies(fix_nomes(reu)),
  #     area = market_segments(nome2),
  #     data_distribuicao = lubridate::dmy_hms(data_distribuicao),
  #     mes = lubridate::floor_date(data_distribuicao, 'months'),
  #     ano = lubridate::year(data_distribuicao)) %>%
  #   filter(stringr::str_trim(assunto_final) %in% stringr::str_trim(assuntos_consumeristas_puros))

  d_tjrs_2 <- read_rds('data-raw/d_tjrs_2.rds') %>%
    mutate(nome2 = fix_labels_2(nome2),
           area = fix_labels_2(area))

  # match_comarca_municipio_tjrs <- readRDS("data-raw/tjrs_comarca_municipio.rds") %>%
  #   bind_rows(data_frame(comarca = "Não-Me-Toque", municipio = "Não-Me-Toque"))

  # mapa_rs <- readRDS("data-raw/GADM_2.8_BRA_adm2.rds")
  # mapa_rs <- mapa_rs[mapa_rs$NAME_1=="Rio Grande do Sul",]
  # mapa_rs$NAME_2 <- case_when(
  #   mapa_rs$NAME_2 == "Baje" ~ "Bagé",
  #   mapa_rs$NAME_2 == "Barao de Cotegipe" ~ "Barão de Cotegipe",
  #   mapa_rs$NAME_2 == "Baro" ~ "Barão",
  #   mapa_rs$NAME_2 == "Campo Real" ~ "Não-Me-Toque",
  #   mapa_rs$NAME_2 == "Dilermano de Aguiar" ~ "Dilermando de Aguiar",
  #   mapa_rs$NAME_2 == "Erval" ~ "Herval",
  #   mapa_rs$NAME_2 == "Inhacor" ~ "Inhacorá",
  #   mapa_rs$NAME_2 == "Boa Vista das Misses" ~ "Boa Vista das Missões",
  #   mapa_rs$NAME_2 == "Cacique doble" ~ "Cacique Doble",
  #   mapa_rs$NAME_2 == "Camagua" ~ "Camaquã",
  #   mapa_rs$NAME_2 == "Lajedão" ~ "Lajeado",
  #   mapa_rs$NAME_2 == "Maçambara" ~ "Maçambará",
  #   mapa_rs$NAME_2 == "Maraú" ~ "Marau",
  #   mapa_rs$NAME_2 == "Maximiliano de Almaeida" ~ "Maximiliano de Almeida",
  #   mapa_rs$NAME_2 == "Palmitinhos" ~ "Palmitinho",
  #   mapa_rs$NAME_2 == "Portao" ~ "Portão",
  #   mapa_rs$NAME_2 == "Rio dos índios" ~ "Rio dos Índios",
  #   mapa_rs$NAME_2 == "São Miguel das Misses" ~ "São Miguel das Missões",
  #   mapa_rs$NAME_2 == "Santo Ángelo" ~ "Santo Ângelo",
  #   mapa_rs$NAME_2 == "urea" ~ "Áurea",
  #   mapa_rs$NAME_2 == "Vitória das Misses" ~ "Vitória das Missões",
  #   T ~ mapa_rs$NAME_2)

  #mapa_rs <- readRDS("data-raw/mapa_rs.rds")
```

## TJRS

Conforme mencionado na seção de metodologia, o Tribunal de Justiça do Rio Grande do Sul forneceu os dados de todos os processos cíveis distribuídos entre 2009 e 2016. Nesta subseção, descrevemos os resultados obtidos nesse estado.

### Os maiores litigantes do Rio Grande do Sul

```{r, echo = F}

maiores_litigantes_tjrs <- d_tjrs_2 %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Similar ao identificado nos demais estados, a empresa com maior número de processos no Rio Grande do Sul foi o grupo de empresas de telefonia Oi Telecomunicações, com `r maiores_litigantes_tjrs$p[1]` dos litígios. Entretanto, destoando dos demais casos consumeristas analisados nesse relatório, o segundo maior litigante é a administradora de cadastro de inadimplentes Serasa, com `r maiores_litigantes_tjrs$p[2]` dos processos.

```{r, results = 'asis'}
head(maiores_litigantes_tjrs, 30) %>%
 knitr::knit_print(caption = "30 maiores litigantes da Justiça Estadual do Rio Grande do Sul. Fonte: Tribunal de Justiça de Rio Grande do Sul.")
```

A lista dos maiores litigantes é composta apenas por bancos, empresas de telefonia e administradores de cadastro de inadimplentes até a posição de número 12. Nessas categorias, os maiores litigantes são os bancos Itaú, Banco do Brasil, Bradesco, Santander, Votorantim e Banrisul, as empresas de telefonia são a Tim, Vivo, Claro e Oi e as administradoras de cadastro são a Boa Vista e a Serasa.

A partir da décima segunda posição, destacam-se novos setores da economia. Na décima terceira posição vê-se a seguradora Líder, administradora do seguro DPVAT, com `r maiores_litigantes_tjrs$p[3]` dos processos, e a partir dessa marca começam a aparecer empresas de energia, luz e água, como a Rio Grande Energia, AES Sul, CEEE e Corsan. Além dessas empresas, novos bancos, como o Banco PAN (antes chamado Banco PanAmericano), BOSCH, BMG e FINASA^[Incorporado ao Banco Bradesco Financiamentos em 2002].

```{r}
maiores_setores_tjrs <- d_tjrs_2 %>%
  count(area) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Os 30 maiores litigantes acumulam `r maiores_litigantes_tjrs$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjrs$p_acum[3]` dos processos concentram-se no setores financeiro, telecomunicações e administradoras de cadastro de inadimplentes. Os três primeiros setores possuem proporções acima de 10% dos processos e caracterizam um ponto de corte na distribuição de processos por empresa: a partir delas, a fatia consumida por cada instituição orbita em 1%. Nas esferas restantes, cujas demandadas concentram menos de 10% do total, destacam-se as concessionárias de serviços básicos, como energia, gás, água e esgoto, e empresas de seguros, com 4,5% e 3,9% dos processos, respectivamente.

```{r, results = 'asis'}
maiores_setores_tjrs %>%
  head(5) %>%
  knitr::knit_print(caption = "5 maiores passivos consumeristas na Justiça Estadual do Rio Grande do Sul. Fonte: Tribunal de Justiça de Rio Grande do Sul.")
```

Considerando o interesse em qualificar certas instituições como demandadas em massa pelos litigantes, partimos para uma análise que buscou averiguar a existência de padrões temporais que expliquem o volume de casos de um certo grande litigante levantado nas tabelas anteriores. Analisando o volume mensal de distribuições de cada tipo de processo, foi possível identificar padrões.

```{r f1, fig.cap = "Volume processual consumerista no Rio Grande do Sul ao longo do tempo e separado por setor econômico. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  count(mes, area) %>%
  filter(area %in% head(maiores_setores_tjrs,10)$area) %>%
  ungroup() %>%
  ggplot(aes(x = mes, y = n)) +
  geom_line() +
  facet_wrap(~area, ncol = 3, nrow = 4, scale = 'free') +
  theme_minimal(12) +
  xlab('Mês de distribuição') +
  ylab('Número de procesoss distribuídos')
```

```{r f2}
total_anual <- d_tjrs_2 %>%
  filter(area == "Administradoras de cadastro de inadimplentes") %>%
  group_by(ano) %>%
  count()

media_sem_2013 <- total_anual %>%
  filter(ano != '2013') %>%
  with(mean(n))

processos_em_2013 <- total_anual %>%
  filter(ano == '2013') %>%
  with(mean(n))
```

O padrão mais claro revelou-se nos processos relacionados à empresas administradoras de banco de dados. No ano de 2013 essas empresas experienciaram uma litigância em massa nunca antes identificada. Enquanto a média de processos por ano, desconsiderando 2013, foi de `r format(media_sem_2013, digits = '2')` processos, em 2013 foram distribuídos `r format(processos_em_2013, digits = '2')` processos. Nessa época, algumas instituições associaram esse aumento repentino à litigância incentivada pelos escritórios de advocacia, contudo é um fato que a quantidade de processos diminuiu com o tempo, indicando que a massa de questões foi causada por alguma característica particular da época.

```{r f3, fig.cap = "Volume processual ao longo do tempo no Rio Grande do Sul contra empresas administradoras de cadastro de inadimplentes. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Administradoras de cadastro de inadimplentes") %>%
  count(mes, nome2) %>%
  filter(nome2 %in% head(maiores_litigantes_tjrs,40)$nome2) %>%
  ungroup() %>%
  ggplot(aes(x = mes, y = n, color = nome2)) +
  geom_line() +
  theme_minimal(12) +
  xlab('Mês de distribuição') +
  ylab('Número de processos distribuídos') +
  theme(legend.position = 'bottom') +
  scale_color_hue(name = 'Empresa')
```

Outros padrões temporais se destacaram, mas, diferentemente do observado nas administradoras de cadastro de inadimplentes, nenhuma série sugere que as questões tratadas nos processos contra a instituição em questão já foram superadas. No caso dos fabricantes de produtos eletrônicos e transporte aéreo, por exemplo, o que ocorre é exatamente o contrário: os processos contra essas empresas estão em ascensão. Em relação às empresas aéreas, o aumento deve-se principalmente à Gol, cujo número de litígios vêm numa tendência de subida desde 2012, mas também é influenciada pelo aumento de processos da TAM de 2010 para 2012.

```{r f4, fig.cap = "Volume processual ao longo do tempo no Rio Grande do Sul contra fabricantes de produtos eletrônicos e companhias aéreas. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
totais <- d_tjrs_2 %>%
  filter(area %in% c("Transporte Aéreo","Fabricantes Eletrônicos")) %>%
  count(mes, area) %>%
  ungroup() %>%
  ggplot(aes(x = mes, y = n, color = area)) +
  geom_line() +
  scale_color_hue(name = 'Área') +
  theme_minimal() +
  theme(legend.position = 'bottom') +
  ylab('Número de processos') +
  xlab('Mês de distribuição')

transporte_aereo <- d_tjrs_2 %>%
  filter(area %in% c("Transporte Aéreo")) %>%
  mutate(area = "Transp. Aéreo") %>%
    filter(nome2 %in% c("Tam","Azul","Gol","Golden Cross","Avianca"))  %>%
  count(mes, area, nome2) %>%
  ggplot(aes(x = mes, y = n, group = nome2, color = nome2)) +
  geom_line() +
  scale_color_hue(name = '') +
  theme_minimal() +
  theme(legend.position = 'bottom') +
  facet_wrap(~area) +
  labs(y = 'Número de processos', x = 'Mês de distribuição')

fabricantes_eletronicos <- d_tjrs_2 %>%
  filter(area %in% c("Fabricantes Eletrônicos")) %>%
  mutate(area = "Eletrônicos") %>%
  filter(nome2 %in% c("Lg","Samsung","CCE","Sony","Positivo","Philips","Cielo","Lenovo")) %>%
  count(mes, area, nome2) %>%
  ggplot(aes(x = mes, y = n, group = nome2, color = nome2)) +
  geom_line(linetype = 2) +
  theme_minimal() +
  geom_smooth(alpha = 0) +
  theme(legend.position = 'bottom') +
  scale_color_hue(name = '') +
  facet_wrap(~area) +
  labs(y = 'Número de processos', x = 'Mês de distribuição')

gridExtra::grid.arrange(totais, gridExtra::arrangeGrob(transporte_aereo, fabricantes_eletronicos, ncol = 2))
```

Um outro padrão detectado nos gráficos de volume processual contra o tempo diz respeito aos setores com uma quantidade aproximadamente constante de processos por mês.f Isso acontece com os processos contra administradoras de planos de Saúde, concessionárias de Energia, Gás e Esgoto, empresas de telecomunicações e empresas de Seguros. Essas quatro esferas, embora tenham experienciado crescimentos desde 2010, apresentam séries estáveis de processos por mês, pelo menos a partir de algum ponto. Dentre os aumentos identificados, destacou-se o patamar atingido pelas empresas de telecomunicações: são registrados aproximadamente 5.500 novos casos por mês.

```{r f5, fig.cap = "Volume processual ao longo do tempo no Rio Grande do Sul das áreas em que identificou-se um aumento (telecomunicações, concessionárias de serviços básicos, planos de saúde e seguros). Fonte: Tribunal de Justiça de Rio Grande do Sul."}
 d_tjrs_2 %>%
  filter(area %in% c("Telecomunicações","Concessionárias de serviços básicos",
                     "Planos de Saúde","Companhias de seguro")) %>%
  count(mes, area) %>%
  ggplot(aes(x = mes, y = n, color = area)) +
  geom_line() +
  theme_minimal() +
  scale_color_hue(name = 'Área') +
  facet_wrap(~area, ncol = 2, nrow = 2, scale = 'free') +
  theme(legend.position = 'bottom') +
  labs(y = 'Número de processos', x = 'Mês de distribuição')
```

O último grupo de padrões temporais identificados diz respeito aos processos que experienciaram um aumento o qual já foi revertido durante o período de estudo. Pertencem à esse grupo as instituições financeiras, empresas relacionadas à recuperação de crédito e supermercados.

```{r f6, fig.cap = "Volume processual ao longo do tempo no Rio Grande do Sul nas áreas em que identificou-se estabilidade (instituições financeiras, supermercados e companhias de recuperação de crédito). Fonte: Tribunal de Justiça de Rio Grande do Sul."}
 d_tjrs_2 %>%
  filter(area %in% c("Instituições Financeiras","Supermercados",
                     "Companhias de recuperação de crédito")) %>%
  count(mes, area) %>%
  ggplot(aes(x = mes, y = n, color = area)) +
  geom_line() +
  theme_minimal() +
  scale_color_hue(name = 'Área') +
  facet_wrap(~area, ncol = 2, nrow = 2, scale = 'free') +
  theme(legend.position = 'bottom')
```

### Causas de pedir

Nesta seção estudamos as causas de pedir mais frequentes contra os maiores litigantes, separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjrs_2 %>%
  filter(area == "Instituições Financeiras") %>%
  count(assunto_final) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

```{r}
head(assuntos_bancos, 10) %>%
  knitr::knit_print(caption = "10 maiores causas de pedir contra instituições financeiras do Rio Grande do Sul. Fonte: Tribunal de Justiça de Rio Grande do Sul.")
```

Com relação às causas de pedir, a maior parte das ações contra instituições financeiras tratam de "Interpretação/ Revisão de Contrato", com `r assuntos_bancos$p[1]` dos processos. No presente contexto, uma análise textual de alguns casos mostrou que a maior parte dos casos desse tipo trata dos contratos de prestação de serviços a clientes, como manutenção de contas correntes e poupanças.

A segunda causa mais frequente dos processos contra instituições bancárias é a classificação geral "Bancários", com `r assuntos_bancos$p[2]`. Segundo a Tabela Processual Unificada, esse vértice deriva três outros assuntos possíveis: "Empréstimo Consignado","Expurgos Inflacionários ou Planos Econômicos" e "Tarifas", mas o erro de classificação pode ou não considerar essa estrutura.

A terceira causa mais frequente dos processos contra instituições bancárias é a classificação geral "Indenização por Dano Moral", com `r assuntos_bancos$p[3]` dos pleitos. Essa é uma classificação geral e, segundo a TPU, admite duas ramificações: "Inclusão Indevida em Cadastro de Inadimplentes" e "Protesto Indevido de Título". Novamente é razoável observar que o erro de classificação pode ou não considerar a hierarquia da Tabela para ocorrer, mas é possível imaginar que processos por danos morais à uma instituição bancária na justiça civil estejam relacionados a cadastros indevidos em bases de inadimplentes.

A quarta causa mais frequente de ações contra instituições bancárias é "Reparação de Danos", com `r assuntos_bancos$p[4]` dos processos. Essa é uma classificação que não consta nas TPU's do primeiro grau da Justiça Estadual. Conforme constatado durante essa pesquisa, a classificação está presente apenas no Tribunal do Rio Grande do Sul, mas nesse caso é bastante frequente. Por esse motivo, concluiu-se que "Reparação de Danos" é uma classificação alternativa para processos cíveis de danos morais ou materiais.

A quinta causa mais frequente dos processos contra instituições financeiras são litígios por "Expurgos Inflacionários/ Planos Econômicos", com `r assuntos_bancos$p[5]` dos processos. Essa é uma classificação específica, derivada da classificação "Bancários". Processos desse tipo pedem indenizações pela atuação de instituições bancárias na ocasião dos planos econômicos brasileiros: Bresser, Verão, Real e os dois planos Collor.

A sexta causa mais frequente dos processos contra instituições financeiras se dão por "Contratos de Consumo", com `r assuntos_bancos$p[6]` dos processos. Essa é uma classificação geral do segundo nível de altura da TPU do primeiro grau da Justiça Estadual. Sob esse nível, estão vários tópicos irrelevantes para instituições financeiras, como "Serviços Hospitalares","Turismo" e "Transporte Aéreo", porém alguns tópicos sugerem sobre o que se tratam os processos classificados dessa forma. Além da classificação "Bancários", já mencionada acima, abaixo de "Contatos de Consumo" aninham-se as classificações "Cartões de Crédito","Consórcio","Plano de Saúde","Seguro" e "Financiamento de Produto", que são plausíveis no contexto financeiro, pois as principais instituições bancárias do Brasil costumeiramente oferecem estes serviços aos seus clientes.

A sétima causa mais frequente dos processos contra instituições financeiras são aqueles por "Financiamento de Produto", com `r assuntos_bancos$p[7]` dos casos. Essa é uma classificação específica, aninhada sobre a classificação anterior, "Contratos de Consumo". Esses processos estão relacionados aos contratos de financiamento de produtos diversos.

A oitava causa mais frequente dos processos contra instituições financeiras são processos com o assunto "Seguros", com `r assuntos_bancos$p[8]` dos casos. Essa classificação é similar à classificação "Financiamento de Produto", mas versa sobre contratos de seguro.

A nona causa mais frequente dos processos contra instituições financeiras são processos com o assunto "Inclusão Indevida em Cadastro de Inadimplentes", com `r assuntos_bancos$p[9]` dos casos. Esse assunto é uma especialização da classificação geral "Indenização por Dano Moral", previamente detectada como a terceira maior causa de litigar contra instituições bancárias.

A décima causa mais frequente dos processos contra instituições financeiras são processos com o assunto "Indenização por Dano Material", com `r assuntos_bancos$p[10]` dos casos. Segundo a TPU, esse assunto é uma especialização da classificação geral "Responsabilidade do Fornecedor", que carece de uma aplicabilidade mais direta no caso financeiro.

Juntas, as dez maiores causas de pedir contra instituições financeiras abarcam mais de 90% dos litígios. Entretanto, para efetivamente consolidá-las como causas de pedir recorrentes no judiciário brasileiro, buscamos por padrões temporais da sua ocorrência, bem como padrões relacionados as instituições demandadas.

Analisando os gráficos do volume processual contra o tempo, concluiu-se que alguns assuntos processuais estão em tendência de queda, enquanto outros estabilizam-se. Processos relacionados à planos econômicos, por exemplo, devido à sua natureza factual, tendem a desaparecer com o tempo e é isso que se observou. Fora o caso extremo mencionado, também notamos o declínio de processos sobre financiamento de produtos e contratos de consumo, que decaem em direção ao zero. Por outro lado, existe classe de processos que estabilizam-se em torno de uma média, como os processos relacionados à interpretação e revisão de contratos, à classificação geral "Bancários", às indenizações morais e materiais e aos processos de "Reparação de Danos".

```{r f7, fig.cap = "Volumes processuais ao longo do tempo dos processos contra instituições financeiras no Rio Grande do Sul. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Instituições Financeiras") %>%
  mutate(em_cima = str_detect(assunto_final, "Expurgos|Interpretação|Bancários")) %>%
  count(em_cima, mes, assunto_final) %>%
  filter(assunto_final %in% assuntos_bancos$assunto_final[1:10]) %>%
  ggplot(aes(x = mes, y = n, color = assunto_final)) +
  geom_line() +
  theme_minimal() +
  scale_color_hue(name = 'Assunto') +
  facet_wrap(~em_cima, scale = 'free', nrow = 2) +
  theme(strip.background = element_blank(),
        strip.placement = 'outside',
        strip.text = element_blank()) +
  labs(x = 'Mês de distribuição', y = 'Número de processos')
```

```{r}
maiores_bancos <- d_tjrs_2 %>%
  filter(area == "Instituições Financeiras",
         assunto_final %in% assuntos_bancos$assunto_final[1:10]) %>%
  count(nome2) %>%
  arrange(desc(n))
```

Com relação às instituições demandadas, observamos uma diferença significativa entre a distribuição dos assuntos do banco BV e a distribuição dos assuntos nas outras instituições bancárias. Nessa instituição, a maior parte dos processos corresponde ao assunto "Interpretação/ Revisão de Contrato". De fato, existem instituições com padrões similares, como o Banco Itaú, FINASA e o Banco PAN, mas nenhuma é tão díspar quanto o Banco Votorantim.

```{r f8, fig.cap = "Distribuições das causas de pedir dos processos contra instituições financeiras do Rio Grande do Sul, separadas por empresa. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Instituições Financeiras",
         assunto_final %in% assuntos_bancos$assunto_final[1:10],
         nome2 %in% maiores_bancos$nome2[1:10]) %>%
  count(nome2, assunto_final) %>%
  ggplot(aes(x = assunto_final, y = n/1000)) +
  geom_bar(stat = 'identity') +
  facet_wrap(~nome2, nrow = 3, ncol = 4) +
  theme_minimal() +
  coord_flip() +
  labs(x = 'Assunto', y = "Número de processos (em milhares)")
```

A despeito dessa diferença nas proporções de assuntos entre os bancos, todos eles experienciaram o mesmo aumento de processos de interpretação ou revisão de contrato no anos de 2012 e 2013. De toda forma, a intensidade variou de maneira similar ao que acontece na distribuição de assuntos.

```{r f9, fig.cap = "Número de processos contra instituições financeiras que versam  sobre interpretação ou revisão de contratos, separado por data de distribuição e institução. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Instituições Financeiras",
         assunto_final == "Interpretação / Revisão de Contrato",
         nome2 %in% maiores_bancos$nome2[1:10]) %>%
  count(mes, nome2) %>%
  ggplot(aes(x = mes, y = n, colour = nome2)) +
  geom_line() +
  scale_color_hue(name = 'Empresa') +
  theme_minimal() +
  labs(x = "Data de distribuição (mês)", y = 'Número de processos') +
  ggtitle("Interpretações ou Revisões de Contratos")
```

### Empresas de telecomunicações

```{r}
telecomunicaoes <- d_tjrs_2 %>%
  filter(area == "Telecomunicações") %>%
  count(assunto_final) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_telecomunicacoes <- d_tjrs_2 %>%
  filter(area == "Telecomunicações") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

De todos os processos contra empresas de telecomunicações, `r telecomunicaoes$p[1]` têm como assunto "Telefonia", e esse é o assunto mais frequente. Segundo a TPU, essa é uma classificação geral que pode possuir três ramificações: processos relacionados à assinatura básica mensal, cobrança indevida de ligações e pulsos excedentes.

O segundo assunto processual mais frequente nos processos consumeristas é o já mencionado "Reparação de Danos", com `r telecomunicaoes$p[2]` dos casos. Esse assunto está relacionado à processos de danos morais e materiais, que figuram nas posições 3 e 8, colocando o tópico "danos morais/materiais" com 38.1% do total de casos referentes à empresas de telefonia.

Após os processos derivados de danos causados aos consumidores, o próximo tópico mais frequente nos tribunais é a cobrança indevida de tarifas, com `r telecomunicaoes$p[4]` dos casos. Não sem relação com esse assunto, o próximo tópico mais procurado pelos consumidores relaciona-se à interpretação e revisão de contrato, com `r telecomunicaoes$p[5]` dos casos, também relacionado com a sétima posição, rescisão do contrato.

Considerando os assuntos mencionados nessa seção, conduzimos uma análise das diferenças nas distribuições de assuntos de cada demandada. Assim como no caso dos bancos, verificamos uma diferença relevante nas distribuições de assuntos: processos sobre interpretações ou revisões de contrato aparecem apenas no grupo empresarial Tim e empresas relacionadas ao grupo Oi são mais demandadas em processos do assunto geral "Telefonia". Embora esse último assunto seja uma classificação não específica, possivelmente ela está relacionada a processos decorrentes de falhas no serviço, pois "Cobrança Indevida de Serviços" também é um assunto que se destaca em empresas do grupo Oi. No geral, as demais empresas apresentam proporções similares de processos de Telefonia, Indenização por Dano Moral e Reparação de Danos, que são as outras formas de classificar danos morais e materiais na justiça estadual gaúcha.

```{r f10, fig.cap = "Distribuições das causas de pedir dos processos contra empresas de telefonia no Rio Grande do Sul, separadas por empresa. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Telecomunicações",
         assunto_final %in% telecomunicaoes$assunto_final[1:10],
         nome2 %in% maiores_telecomunicacoes$nome2[1:4]) %>%
  ggplot(aes(x = assunto_final)) +
  geom_bar() +
  facet_wrap(~nome2, nrow = 2, ncol = 2) +
  theme_minimal() +
  coord_flip() +
  labs(x = "Causa de pedir (Assunto)", y = "Frequência")
```

Assim como existem diferenças no volume de cada assunto processual, também identificamos padrões temporais distintos em cada uma das maiores litigantes de telefonia. O volume processual associado ao grupo Oi é muito maior do que os demais, com exceção de processos relacionados à Inclusão Indevida em Cadastro de Inadimplentes e Interpretação ou Revisão de Contratos, e, em geral, o volume processual da Oi está em ascensão, exceto pelos casos relacionados à Telefonia e Reparação de Danos. Nesse último caso vale a pena notar que o número total de casos está diminuindo, possivelmente por tratar-se de uma classificação antiga que está caindo em desuso, dando lugar às classificações "Indenização por Dano Moral" e "Inclusão Indevida em Cadastro de Inadimplentes".

Ainda sobre os padrões temporais, destacou-se também a diferença dos processos relacionados à TIM. Das empresas de telefonia com maior número de litígios na Justiça Estadual do Rio Grande do Sul ela é a única cujo volume processual relacionado à Inclusão Indevida em Cadastro de Inadimplentes não está subindo, mas pudemos notar uma concentração de processos relacionados à Interpretação e Revisão de Contratos.

```{r f11, fig.cap = "Número de processos contra empresas de telecomunicações ao longo do tempo separado por empresa. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Telecomunicações",
         assunto_final %in% telecomunicaoes$assunto_final[1:6],
         nome2 %in% maiores_telecomunicacoes$nome2[1:4]) %>%
  count(nome2, mes, assunto_final) %>%
  ggplot(aes(x = mes, y = n, color = nome2)) +
  geom_line() +
  scale_color_hue(name = 'Empresa') +
  facet_wrap(~assunto_final, scale = 'free', ncol = 2, nrow = 3) +
  theme_minimal() +
  labs(x = "Data de distribuição (mensal)", y = "Frequência")
```

### Admnistradores de cadastro de inadimplentes

```{r}
maiores_assuntos_banco_de_dados <- d_tjrs_2 %>%
  filter(area == "Administradoras de cadastro de inadimplentes") %>%
  count(assunto_final) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

litigantes_banco_de_dados <- d_tjrs_2 %>%
  filter(area == "Administradoras de cadastro de inadimplentes") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

A menos de empresas não contabilizadas neste estudo, todos os processos contra administradores de crédito concentraram-se em apenas quatro instituições: Serasa Experian, com `r litigantes_banco_de_dados$p_acum[1]` dos casos, Boa Vista SCPC, com `r litigantes_banco_de_dados$p_acum[2]` dos casos, CDL de Porto Alegre, com `r litigantes_banco_de_dados$p_acum[3]`, e o Serviço de Proteção ao Crédito (SPC), com `r litigantes_banco_de_dados$p_acum[4]`.

Do mesmo modo, apenas quatro assuntos processuais acumularam mais de 90% dos casos, sendo todos eles relacionados direta ou indiretamente com o cadastro indevido nas bases de inadimplentes. `r maiores_assuntos_banco_de_dados$p[1]` são processos por "Indenização de Danos Morais" e os próximos três assuntos, "Cadastro de Análise de Crédito", "Inclusão Indevida em Cadastro de Inadimplentes" e "Registro em Cadastro de Análise de Crédito" versam sobre a mesma matéria e juntos concentraram 55% dos processos.

Ao contrário do identificado nos assuntos adiante, os padrões temporais existentes nas empresas administradoras de banco de dados limitam-se ao já identificado: os processos concentram-se em 2013, para todas as demandadas. Um desvio a esse padrão apareceu nos processos classificados como "Inclusão Indevida em Cadastro de Inadimplentes", que experienciaram um aumento gradual no número de processos até 2013, quando esse número atingiu seu máximo.

```{r f12, fig.cap = "Número de processos contra empresas administradoras de cadastro de inadimplentes ao longo do tempo e separado por tipo de processo. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Administradoras de cadastro de inadimplentes",
         assunto_final %in% maiores_assuntos_banco_de_dados$assunto_final[1:4],
         nome2 %in% litigantes_banco_de_dados$nome2[1:4]) %>%
  count(nome2, mes, assunto_final) %>%
  ggplot(aes(x = mes, y = n, color = nome2)) +
  geom_line() +
  scale_color_hue(name = 'Empresa') +
  facet_wrap(~assunto_final, scale = 'free', ncol = 2, nrow = 2) +
  theme_minimal() +
  labs(x = 'Mês de distribuição', y = 'Número de processos')
```

### Companhias de Luz, Água e Esgoto

```{r}
maiores_assuntos_energia_gas <- d_tjrs_2 %>%
  filter(area == "Concessionárias de serviços básicos") %>%
  count(assunto_final) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

litigantes_energia_gas <- d_tjrs_2 %>%
  filter(area == "Concessionárias de serviços básicos") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Da mesma forma que observamos nos processos contra administradoras de cadastros de inadimplentes, os processos contra empresas concessionárias de serviços básicos como energia, gás e água concentraram-se em quatro companhias.

```{r}
litigantes_energia_gas %>%
  head(4) %>%
  knitr::knit_print(caption = "4 Maiores Litigantes concessionárias de serviços básicos no estado do Rio Grande do Sul. Fonte: Tribunal de Justiça de Rio Grande do Sul.")
```

A distribuição de assuntos é similar às identificadas anteriormente, mas a separação por empresa faz mais sentido. Certos processos, como "Fornecimento de Energia Elétrica", só apareceram vinculadas à certas empresas. Nesse aspecto, pudemos dividir as empresas deste segmento econômico em dois grupos: as empresas de energia e a CORSAN, empresa Rio Grandense de Saneamento. Indenizações por Dano Moral são frequentes em todas empresas, mas Fornecimento de Energia Elétrica não apareceu vinculada à CORSAN, evidentemente, assim como processos discutindo a Metodologia de Reajuste das Tarifas e Indenizações por Danos Materiais.

```{r f13, fig.cap = 'Distribuições das causas de pedir contra concessionárias de serviços básicos separadas por empresa.'}
d_tjrs_2 %>%
    filter(area == "Concessionárias de serviços básicos",
           assunto_final %in% maiores_assuntos_energia_gas$assunto_final[1:10],
           nome2 %in% litigantes_energia_gas$nome2[1:4]) %>%
    ggplot(aes(x = assunto_final)) +
    geom_bar() +
    facet_wrap(~nome2, nrow = 2, ncol = 2) +
    theme_minimal() +
    coord_flip() +
    scale_color_hue(name = "Empresa") +
    labs(x = 'Causa de Pedir (Assunto)', y = 'Número de processos')
```

Com relação aos padrões temporais, a conclusão geral foi que a maior parte dos processos deveu-se a ilícitos cometidos pontualmente, já que distribuem-se ao longo dos anos com muitos picos e períodos com baixo volume processual. Já os processos que lidam com a questão do serviço propriamente dito são mais estáveis: os processos relacionados ao Fornecimento de Água contra a CORSAN estão crescendo, mas a média mensal de processos distribuídos orbita os 50 processos/mês, e os processos relacionados ao Fornecimento de Energia Elétrica não tiveram variação no tempo.

```{r f14, fig.cap = "Número de processos contra concessionárias de serviços básicos ao longo do tempo separado por tipo de processo. Fonte: Tribunal de Justiça de Rio Grande do Sul."}
d_tjrs_2 %>%
  filter(area == "Concessionárias de serviços básicos",
         assunto_final %in% maiores_assuntos_energia_gas$assunto_final[1:10],
         nome2 %in% litigantes_energia_gas$nome2[1:4]) %>%
  count(nome2, mes, assunto_final) %>%
  ggplot(aes(x = mes, y = n, color = nome2)) +
  geom_line() +
  scale_color_hue(name = "Empresa") +
  facet_wrap(~assunto_final, scale = 'free', ncol = 3, nrow = 4) +
  theme_minimal() +
  theme(legend.position = 'bottom') +
  labs(x = 'Mês de distribuição', y = 'Número de processos')
```

<!-- É importante mencionar, também, que existe padrões geográficos para os litígios de cada uma dessas empresas. Os processos da Companhia Estadual de Energia Elétrica do Rio Grande do Sul concentram-se na Região Sul do estado e no litoral. -->

```{r}
# library(tmap)
# library(tmaptools)
#
# completa_data_set <- function(d, municipios = match_comarca_municipio_tjrs$municipio){
#   municipios_que_faltam <- municipios[!municipios %in% d$municipio]
#   data_frame_pra_bindar <- data_frame(municipio = municipios_que_faltam, n = 0)
#
#   d %>%
#     select(-comarca) %>%
#     bind_rows(data_frame_pra_bindar)
# }
#
# d1 <- d_tjrs_2 %>%
#   filter(area %in% c("energia_gas_agua_esgoto"),
#          nome2 %in% litigantes_energia_gas$nome2[1]) %>%
#   count(comarca) %>%
#   left_join(match_comarca_municipio_tjrs) %>%
#   completa_data_set()
#
# d2 <- d_tjrs_2 %>%
#   filter(area %in% c("energia_gas_agua_esgoto"),
#          nome2 %in% litigantes_energia_gas$nome2[2]) %>%
#   count(comarca) %>%
#   left_join(match_comarca_municipio_tjrs) %>%
#   completa_data_set()
#
# d3 <- d_tjrs_2 %>%
#   filter(area %in% c("energia_gas_agua_esgoto"),
#          nome2 %in% litigantes_energia_gas$nome2[3]) %>%
#   count(comarca) %>%
#   left_join(match_comarca_municipio_tjrs) %>%
#   completa_data_set()
#
# d4 <- d_tjrs_2 %>%
#   filter(area %in% c("energia_gas_agua_esgoto"),
#          nome2 %in% litigantes_energia_gas$nome2[4]) %>%
#   count(comarca) %>%
#   left_join(match_comarca_municipio_tjrs) %>%
#   completa_data_set()
#
# monta_mapa <- function(d, quantis = 0.15, titulo = ''){
#   rs_bancos_1 <- tmaptools::append_data(mapa_rs, d, key.shp = 'NAME_2', key.data = "municipio", ignore.duplicates = T, ignore.na = T)
#   tm_shape(rs_bancos_1)+
#   tm_fill(col="n", breaks = quantile(unique(d$n), seq(0,1,quantis)), colorNA = NULL, title = "Número de reclamações") +
#   tm_borders(col="white", alpha=.8) +
#   tm_scale_bar() +
#   tm_compass(position=c("RIGHT","TOP"),type="4star") +
#   tm_layout(title = titulo)
# }
#
# mapa_1 <- monta_mapa(d1, titulo = "CEEE")
# mapa_2 <- monta_mapa(d2, titulo = "Rio Grande Energia")
# mapa_3 <- monta_mapa(d3, titulo = "AES")
# mapa_4 <- monta_mapa(d4, titulo = "CORSAN")
```

```{r}
library(tidyverse)

control_table <- tpur::control_table
tpu <- readRDS("data-raw/tpu.rds")
l_tpu <- readRDS("data-raw/l_tpu.rds")

assuntos_consumeristas_tpu <- readRDS("data-raw/assuntos_consumeristas_tpu.rds")

codigos_consumeristas_puros <- assuntos_consumeristas_tpu$codigo

  #especifico tjrs
  {especifico_tjrs <- c("Abatimento proporcional do preço",
                              "Cadastro de Análise de Crédito",
                              "Cobrança indevida de ligações ",
                              "Cobrança Indevida de Serviços",
                              "Comercialização de dados cadastrais de consumidores",
                              "Contratos de Participacao Financeira",
                              "Medicamento/ Tratamento/ Cirurgia de Eficácia não comprovada",
                              "Metodologia de Reajuste de Tarifa - IRT",
                              "Notificação",
                              "Registro em Cadastro de Análise de Crédito",
                              "Registro em Cadastro",
                              "Registro em Cadastro de Inadimplentes",
                              "Registro para comercialização de dados cadastrais de consumidores",
                              "Reparação de Danos")}

assuntos_consumeristas_puros <- l_tpu %>%
  dplyr::filter(codigo %in% codigos_consumeristas_puros) %>%
  with(assunto) %>%
  c(especifico_tjrs) %>%
  unique
```

## TJRJ

Conforme mencionado na seção de metodologia, os processos enviados pelo Tribunal de Justiça do Rio de Janeiro foram utilizados originalmente para a premiação do Selo Justiça em Números. Por conta disso, as análises desse tribunal foram separadas de acordo com os mecanismos de seleção dos processos enviados ao CNJ.

A qualidade da administração dos dados do TJRJ foi mensurada utilizando três tipos de processos, que estão discriminados na base enviada pelo CNJ:

1. Processos baixados entre 01/01/2015 e 31/07/2016.
2. Processos em tramitação no dia 31/07/2016.
3. Processos com alguma movimentação ou utilização no mês de agosto de 2016.

```{r}
library(tidyverse)

d_tjrj <- readRDS("data-raw/d_tjrj_final_diminuto.rds") %>%
  set_names(c("numero","nome","nome2","descricao","area","arquivo")) %>%
  filter(stringr::str_trim(descricao) %in% stringr::str_trim(assuntos_consumeristas_puros)) %>%
  distinct(numero, nome2, .keep_all = T)

numero_de_processos <- unique(d_tjrj$numero) %>% length
```

### Os maiores litigantes do Rio de Janeiro

```{r, echo = F}

maiores_litigantes_tjrj <- d_tjrj %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/numero_de_processos),
    p_acum = scales::percent(cumsum(n)/numero_de_processos))

maiores_setores_tjrj <- d_tjrj %>%
  count(area) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/numero_de_processos),
    p_acum = scales::percent(cumsum(n)/numero_de_processos))
```

Similar ao identificado em outros estados, o maior litigante no estado do Rio de Janeiro pertence ao setor das telecomunicações. O grupo de empresas ligadas à Oi Telefonia concentra `r maiores_litigantes_tjrj$p[1]` de todos os processos consumeristas do estado. Nas primeiras posições, destacam-se também as instituições bancárias, sendo mais expressivos os grupos empresariais ligados ao Banco Itaú e ao Banco Bradesco, com `r maiores_litigantes_tjrj$p[2]` e `r maiores_litigantes_tjrj$p[4]` dos processos, respectivamente.

```{r}
maiores_litigantes_tjrj %>%
  head(30) %>%
  knitr::knit_print(caption = "30 maiores litigantes da justiça consumerista no estado do Rio de Janeiro. Fonte: Selo Justiça em Números.")
```

A principal particularidade do estado do Rio encontra-se na quinta posição: a Light, distribuidora de energia, concentra `r maiores_litigantes_tjrj$p[5]` dos processos consumeristas do estado, abaixo apenas das maiores instituições bancárias e empresas de telefonia. Além disso, também destaca-se o fato do grupo Via Varejo, uma empresa varejista, aparecer na lista das 10 maiores litigantes consumeristas, episódio não identificado em nenhum outro estado.

Os 30 maiores litigantes acumulam aproximadamente `r maiores_litigantes_tjrj$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjrj$p_acum[5]` dos processos concentram-se no setores financeiro, fornecimento de energia e água, telecomunicações, seguros e varejo. As quatro primeiras classes possuem proporções acima de 5% dos processos e caracterizam um ponto de corte na distribuição de processos por empresa: abaixo dos 5%, a fatia consumida por cada instituição orbita os 1%. Nessa nova classe de processos, cujas demandadas concentram menos de 5% do total, destacam-se as empresas de varejo e seguros, com `r maiores_setores_tjrj$p[4]` e `r maiores_setores_tjrj$p[5]` do total de processos, respectivamente.

```{r}
maiores_setores_tjrj %>%
  head(5) %>%
  knitr::knit_print(caption = "5 setores econômicos com maior quantidade de processos consumeristas no estado do Rio de Janeiro. Fonte: Selo Justiça em Números.")
```

### Causas de pedir

<!-- Globalmente, as causas dez maiores causas de de pedir às empresas do TJRJ distribuem-se de acordo com a tabela abaixo. -->

<!-- ```{r} -->
<!-- d_tjrj %>% -->
<!--   distinct(numero, .keep_all = T) %>%  -->
<!--   count(descricao) %>% -->
<!--   arrange(desc(n)) %>% -->
<!--   mutate(p = n/sum(n), -->
<!--          p_acum = cumsum(p), -->
<!--          p = scales::percent(p), -->
<!--          p_acum = scales::percent(p_acum)) %>%  -->
<!--   head(10) %>%  -->
<!--   knit_print(caption = "8 causas de pedir consumeristas mais frequentes no estado do Rio de Janeiro.") -->
<!-- ``` -->

Nesta seção estudamos as causas de pedir mais frequentes dentre os maiores litigantes separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjrj %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  distinct(numero, .keep_all = T) %>%
  count(descricao) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_bancos <- d_tjrj %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  distinct(numero, .keep_all = T) %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

No TJRJ, 3 assuntos da TPU contemplam `r assuntos_bancos$p_acum[3]` do total de processos consumeristas contra bancos e instituições financeiras.

```{r}
assuntos_bancos %>%
  head(10) %>%
  knitr::knit_print(caption = "8 causas de pedir consumeristas mais frequentes conta instituições financeiras no estado do Rio de Janeiro. Fonte: Selo Justiça em Números.")
```

O assunto mais frequente, com `r assuntos_bancos$p[1]` dos processos, diz respeito à indenizações por danos morais. Em seguida, tem-se a classificação genérica "Responsabilidade do Fornecedor", com `r assuntos_bancos$p[2]` dos processos. Essa é uma classificação genérica que pode ser particularizada para  "Indenização por Dano Moral".

A partir do terceiro assunto mais frequente questões relativas à prestação de serviços bancários passaram a aparecer. A classificação genérica "Bancários", que aparece em `r assuntos_bancos$p[3]` dos processos, segundo a TPU é uma classificação relacionada a empréstimos consignados, expurgos inflacionários e tarifas. Logo em seguida, o quarto assunto mais frequente se manteve no mesmo sentido: "Contratos de Consumo" é uma classificação acima de "Bancários" e que abarca outros serviços prestados por instituições financeiras, como financiamentos, cartões de crédito e consórcios.

#### Telecomunicações

```{r}
assuntos_telecom <- d_tjrj %>%
  filter(area == "telecomunicacoes") %>%
  distinct(numero, .keep_all = T) %>%
  count(descricao) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_telecom <- d_tjrj %>%
  filter(area == "telecomunicacoes") %>%
  distinct(numero, .keep_all = T) %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Similar ao identificado nos processos contra instituições bancárias, as causas de pedir contra empresas de telefonia também são bastante polarizadas: `r assuntos_telecom$p_acum[3]` dos processos estão concentrados em três assuntos. Esses assuntos, inclusive, são similares aos assuntos mais frequentes do setor bancário.

Dentre os processos consumeristas, `r assuntos_telecom$p_acum[2]` versam, direta ou indiretamente, sobre indenizações por danos morais, sendo esta exatamente a classificação mais frequente e "Responsabilidade do Fornecedor", uma de suas versões mais genéricas, a segunda mais frequente.

```{r}
assuntos_telecom %>%
  head(10) %>%
  knitr::knit_print(caption = "9 assuntos consumeristas mais frequentes contra empresas de telecomunicações no estado do Rio de Janeiro. Fonte: Selo Justiça em Números.")
```

#### Empresas de energia, gás, água e esgoto

```{r}
assuntos_energia <- d_tjrj %>%
  filter(area == "energia_gas_agua_esgoto") %>%
  distinct(numero, .keep_all = T) %>%
  count(descricao) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_energia <- d_tjrj %>%
  filter(area == "energia_gas_agua_esgoto") %>%
  distinct(numero, .keep_all = T) %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Seguindo o padrão dos setores analisados até então, as empresas distribuidoras de água, gás e energia também possuem uma grande polarização dos assuntos. Os três primeiros assuntos concentram `r assuntos_energia$p_acum[3]` dos processos, e novamente são em grande parte processos de indenização por danos morais.

```{r}
assuntos_energia %>%
  head(10) %>%
  knitr::knit_print(caption = "6 assuntos consumeristas mais frequentes contra empresas de concessionárias de serviços básicos no estado do Rio de Janeiro. Fonte: Selo Justiça em Números.")
```

O agravante dos processos desse setor no tribunal fluminense está também na polarização das companhias processadas. Nesse setor, 4 companhias concentram `r maiores_litigantes_energia$p_acum[4]` dos processos.

```{r}
maiores_litigantes_energia %>%
  head(4) %>%
  knitr::knit_print(caption = "4 primeiras companhias concessionárias de serviços básicos com maior quantidade de processos consumeristas no estado do Rio de Janeiro. Fonte: Selo Justiça em Números.")
```

## TJSP

```{r}
# d_tjsp <- read_rds('data-raw/base_filtrada_consumeristas_sp.rds') %>%
#     mutate(nome2 = aggregate_major_companies(fix_nomes(reu)),
#     area = market_segments(nome2))
#
# d_tjsp_2 <- d_tjsp %>%
#   mutate(mes = lubridate::floor_date(dt_dist, 'months'),
#     ano = lubridate::year(dt_dist),
#     area = market_segments(nome2)) %>%
#   filter(stringr::str_trim(assunto) %in% stringr::str_trim(assuntos_consumeristas_puros)) %>%
#   filter(dt_dist >= as.Date('2010-01-01'),
#          dt_dist < as.Date('2016-01-01'))

d_tjsp_2 <- readRDS("data-raw/d_tjsp_2.rds")

numero_de_processos <- d_tjsp_2$n_processo %>% unique %>% length
```

Conforme mencionado na seção de metodologia, o Tribunal de Justiça de São Paulo forneceu os dados de todos os processos cíveis distribuídos entre 2009 e 2016. Nesta seção, descrevemos os resultados obtidos nesse estado.

### Os maiores litigantes de São Paulo

```{r, echo = F}
maiores_litigantes_tjsp <- d_tjsp_2 %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/numero_de_processos),
    p_acum = scales::percent(cumsum(n)/numero_de_processos))
```

Destoando do que foi identificado nos demais estados, o grupo de empresas ligadas ao Banco Itaú teve o maior número de processos em São Paulo, com `r maiores_litigantes_tjsp$p[1]` dos litígios. Ao contrário dos demais estados, uma empresa de telecomunicação, a Tim, aparece apenas na oitava posição, com `r maiores_litigantes_tjsp$p[2]` dos processos.

```{r}
head(maiores_litigantes_tjsp, 30) %>%
  knitr::knit_print(caption = "30 maiores litigantes da justiça consumerista no estado de São Paulo. Fonte: Tribunal de Justiça de São Paulo.")
```

Também distante do que foi encontrado nos demais estados, a Oi não figura na lista dos maiores litigantes, deixando bastante espaço para instituições financeiras, embora outras empresas de telefonia também sejam responsáveis por uma boa quantidade dos processos consumeristas do estado. Dentre as instituições financeiras, os maiores litigantes são os bancos Itaú, Bradesco, Votorantim, Santander e Banco do Brasil, enquanto as maiores dentre todas as operadoras de telefonia são Tim, Vivo e Claro.

A partir da nona posição destacam-se novos setores da economia. A partir desse ponto, passam a figurar na lista de maiores litigantes algumas empresas administradoras de seguros e planos de saúde, como Unimed, Amil e SulAmérica. Além dessas empresas, também aparecem outras instituições financeiras, como o Banco PAN, BOSCH e FINASA.

```{r}
maiores_setores_tjsp <- d_tjsp_2 %>%
  count(area) %>%
  distinct(n_processo, .keep_all = T) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Os 30 maiores litigantes acumulam `r maiores_litigantes_tjsp$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjsp$p_acum[5]` dos processos estão concentrados nos setores financeiro, telecomunicações, seguros, planos de saúde e concessionárias de serviços básicos. As três primeiras classes possuem proporções acima de 10% dos processos e caracterizam um ponto de corte na distribuição de processos por empresa: a partir delas, a fatia consumida por cada instituição orbita os 1%. Nessa nova classe de processos, cujas demandadas concentram menos de 10% do total, destacam-se as concessionárias de serviços básicos, como energia, gás, água e esgoto, empresas de varejo e transporte aéreo, com 1,7%, 1,7% e 1,6% dos processos, respectivamente.

```{r}
maiores_setores_tjsp %>%
  head(5) %>%
  knitr::knit_print(caption = "5 setores da economia mais demandados na justiça consumerista do estado de São Paulo. Fonte: Tribunal de Justiça de São Paulo.")
```

Partiremos agora para uma análise que busca averiguar a existência de padrões temporais que expliquem o volume de casos de um certo grande litigante levantado nas tabelas anteriores. Analisando o volume mensal de distribuições de cada tipo de processo, é possível identificar certos padrões temporais.

As curvas de volume processual mensal do Tribunal de Justiça de São Paulo destacam-se por padrões sazonais claros e aumentos contínuos. Na verdade, essa distinção é tão clara que é possível separar as séries do volume processual de cada setor econômico em duas classes, aqueles volumes que estão crescendo e aqueles volumes que estão se estabilizando.

```{r, fig.cap = "Número de processos consumeristas distribuídos no estado de São Paulo ao longo do tempo, separado por setor econômico da demandada. Fonte: Tribunal de Justiça de São Paulo."}
d_tjsp_2 %>%
  count(mes, area) %>%
  filter(area %in% head(maiores_setores_tjsp,10)$area) %>%
  mutate(area = fix_labels(area)) %>%
  ggplot(aes(x = mes, y = n)) +
  geom_line() +
  facet_wrap(~area, ncol = 3, nrow = 4, scale = 'free') +
  theme_minimal() +
  labs(x = "Mês de distribuição", y = "Número de processos distribuídos")
```

Dentre as 10 áreas com maior volume processual no TJSP, os processos contra administradoras de planos de saúde, empresas de seguros, varejo e telecomunicações estão crescendo. Entretanto, em alguns casos é possível notar que o crescimento é governado por apenas algumas das instituições daquele setor.

No caso dos planos de saúde, por exemplo, nota-se que o crescimento dos processos contra a Unimed é maior do que o crescimento dos processos contra a Amil. De maneira análoga, pode-se concluir que os processos contra a SulAmérica crescem muito mais rapidamente do que os processos contra a ACE, e o mesmo vale para os processos contra a Via Varejo e Magazine Luiza. Para as empresas de telecomunicações, entretanto, nenhum efeito desse tipo foi detectado: o volume processual das três empresas principais cresce similarmente.

```{r}
d_tjsp_2 %>%
  filter(area %in% c("telecomunicacoes","varejo","planos_de_saude","seguros")) %>%
  count(mes, area, nome2) %>%
  filter(area %in% head(maiores_setores_tjsp,10)$area,
         nome2 %in% head(maiores_litigantes_tjsp,40)$nome2) %>%
  mutate(area = fix_labels(area),
         nome2 = fix_labels(nome2)) %>%
  ggplot(aes(x = mes, y = n, color = nome2)) +
  geom_line() +
  facet_wrap(~area, ncol = 2, nrow = 2, scale = 'free') +
  theme_minimal() +
  theme(legend.position = 'bottom') +
  labs(x = 'Mês de distribuição', y = "Número de processos distribuídos") +
  scale_color_hue(name = "Empresa")
```

Passando agora para os processos com curvas de volume processual estáveis, não se identifica diferença no comportamento de todas as empresas dentro de cada área. Todos os volumes processuais são estáveis. Mesmo no caso das companhias de transporte aéreo, o aumento do volume processual com relação a 2010 acontece apenas até 2014, quando as curvas se estabilizam.

```{r, fig.cap="Volume de processos distribuídos ao longo do tempo, por setor e nome da empresa. Fonte: Tribunal de Justiça de São Paulo."}
d_tjsp_2 %>%
  filter(area %in% c("energia_gas_agua_esgoto","fabricantes_electronicos","supermercados","recuperacao_credito","transporte_aereo")) %>%
  count(mes, area, nome2) %>%
  filter(area %in% head(maiores_setores_tjsp,10)$area,
         nome2 %in% head(maiores_litigantes_tjsp,40)$nome2) %>%
  mutate(area = fix_labels(area),
         nome2 = fix_labels(nome2)) %>%
  ggplot(aes(x = mes, y = n, color = nome2)) +
  geom_line() +
  facet_wrap(~area, ncol = 2, nrow = 2, scale = 'free') +
  theme_minimal() +
  theme(legend.position = 'bottom') +
  labs(x = 'Mês de distribuição', y = "Número de processos distribuídos") +
  scale_color_hue(name = "Empresa")
```

### Causas de pedir

Nesta seção estudamos as causas de pedir mais frequentes contra os maiores litigantes, separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjsp_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  distinct(n_processo, .keep_all = T) %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_bancos <- d_tjsp_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  distinct(n_processo, .keep_all = T) %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

No TJSP, 6 assuntos da TPU contemplam `r assuntos_bancos$p_acum[6]` do total de processos contra bancos e instituições financeiras. O assunto mais discutido nos tribunais, com `r assuntos_bancos$p[1]` dos processos, diz respeito à "Interpretação / Revisão de Contrato". Logo em seguida, tem-se a classificação genérica "Bancários", com `r assuntos_bancos$p[2]` dos processos, que, segundo a TPU, podem tratar-se de "Empréstimos consignados", "Expurgos Inflacionários / Planos Econômicos" e "Tarifas".

Na terceira posição surge a "Inclusão Indevida em Cadastro de Inadimplentes", com `r assuntos_bancos$p[3]` dos processos. Logo a seguir, mas não sem relação, encontram-se os processos que pedem indenizações por danos morais, com `r assuntos_bancos$p[4]` dos casos.

Esses primeiros 4 assuntos já acumulam 85% de todos os processos consumeristas contra instituições bancárias, mas dois assuntos processuais ainda se destacam, considerando que o restante da lista refere-se a temas repetidos ou aninhados dentro de classificações mais gerais, como "Bancários". Os dois temas que se destacam são Planos de Saúde, com  `r assuntos_bancos$p[5]` dos processos, e Financiamento de Produto, com `r assuntos_bancos$p[6]` dos processos.

Embora os 6 primeiros assuntos processuais mais frequentes sejam expressivos, o volume processual de um deles concentra-se em um certo período do tempo. Processos classificados como "Financiamento de Produtos" apresentam um decaimento constante a partir de 2012, de tal forma que os processos desse assunto só foram distribuídos entre 2012 e 2014.

```{r}
d_tjsp_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  filter(assunto %in% assuntos_bancos$assunto[1:6]) %>%
  count(mes, assunto) %>%
  mutate(assunto = str_wrap(assunto, 15)) %>%
  ggplot(aes(x = mes, y = n, color = assunto)) +
  geom_line() + theme_bw() + theme(strip.background = element_blank(), strip.placement = 'outside', strip.text = element_blank()) +
  labs(x = "Mês de distribuição", y = "Número de procesos distribuídos") +
  theme(legend.position = 'bottom')
```

#### Empresas de telecomunicações

```{r}
telecomunicaoes <- d_tjsp_2 %>%
  filter(area == "telecomunicacoes") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_telecomunicacoes <- d_tjsp_2 %>%
  filter(area == "telecomunicacoes") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

De todos os processos contra empresas de telecomunicações, `r telecomunicaoes$p[1]` têm como assunto "Telefonia", e esse é o assunto mais frequente. Segundo a TPU, essa é uma classificação geral que pode possuir três ramificações: processos relacionados à assinatura básica mensal, cobrança indevida de ligações e pulsos excedentes.

O segundo assunto mais comum contra processos de telefonia no TJSP são processos por inclusão indevida em cadastro de inadimplentes, com  `r telecomunicaoes$p[2]` dos processos. Não sem relação, o terceiro tipo de processos mais demandado contra empresas de telefonia são processos de indenização por dano moral, com `r telecomunicaoes$p[3]` dos litígios.

Após os processos de danos morais, o próximo tópico mais frequente nos tribunais é reinterpretação ou revisão de contratos, com `r telecomunicaoes$p[4]` dos casos, seguido de rescisão e devolução de dinheiro, em `r telecomunicaoes$p[5]` dos casos.

#### Empresas de seguros

```{r}
seguros <- d_tjsp_2 %>%
  filter(area == "seguros") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_seguros <- d_tjsp_2 %>%
  filter(area == "seguros") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Com relação às causas de pedir, a maior parte dos processos contra seguradoras foi classificada segundo o assunto "Planos de Saúde", com `r seguros$p[1]` dos casos. Logo em seguida, com `r seguros$p[2]` dos processos, vêm os casos classificados como "Seguro".

Apenas na terceira posição a classificação mais comum da justiça consumerista, indenização por danos morais, aparece na lista das maiores causas de pedir à empresas consumeristas, com `r seguros$p[3]`. Se somarmos a proporção de casos na quinta posição, `r seguros$p[5]` processo de indenização por danos materiais, concluiremos que o total de processos relacionados a indenização de danos chega a 13,6% do total de casos.

Os demais processos, com exceção dos processos com assunto "Inclusão Indevida em Cadastro de Inadimplentes", tratam sobre os serviços prestados pelas seguradoras e, quando levados em conta, somam mais de 95% do total de casos contra seguradoras.

## TJMT

```{r}
# d_tjmt <- readRDS("data-raw/base_filtrada_apenas_consumeristas_tjmt.rds") %>%
#   filter(assunto_nome %in% assuntos_consumeristas_puros) %>%
#   mutate(nome2 = aggregate_major_companies(fix_nomes(selo_pessoa)),
#          area = market_segments(nome2))
#
# d_tjmt_2 <- d_tjmt %>%
#   filter(selo_pessoa_tipo == "JURIDICA",
#          str_detect(selo_nome_orgao_julgador,
#                     regex("Vara Especializada em Direito Banc[aá]rio|Vara Especializada Direito Banc[aá]rio|Vara C[íi]vel|Vara [Úu]nica|Juizado Especial C[íi]vel|Vara Criminal e C[íi]vel|Vara$|Vara Especializada Ação Civil Pública e Ação Popular|VARA ESP. AÇÃO CIVIL PÚBLICA E AÇÃO POPULAR|Juizado Especial($| [(]Projudi[)] )|Vara Especializada dos Juizados Especiais", ignore_case = T)),
#          selo_pessoa_polo == "PA") %>%
#   mutate(data_dist = as.Date(
#     as.numeric(selo_data_de_ajuizamento), origin = '1899-12-30'),
#          mes = lubridate::floor_date(data_dist, 'months'),
#          ano = lubridate::year(data_dist))

d_tjmt_2 <- readRDS("data-raw/d_tjmt_2.rds")

numero_de_processos <- d_tjmt_2$selo_processo_numero_unico %>% unique %>% length()
```

Conforme mencionado na seção de metodologia, o Tribunal de Justiça do Mato Grosso forneceu os dados referentes ao Selo Justiça em Números. Nesta seção descrevemos os resultados obtidos nesse estado.

### Os maiores litigantes do Mato Grosso

```{r, echo = F}
maiores_litigantes_tjmt <- d_tjmt_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/numero_de_processos),
    p_acum = scales::percent(cumsum(n)/numero_de_processos))

maiores_setores_tjmt <- d_tjmt_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  count(area) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Similar ao identificado em São Paulo, a empresa com maior número de processos no Mato Grosso foi uma instituição bancária. Nesse estado, o grupo de empresas relacionado ao Banco Bradesco concentra `r maiores_litigantes_tjmt$p[1]` dos litígios. Logo em seguida, diferente do que ocorre com os processos paulistas, vem a companhia de telefonia Claro, com `r maiores_litigantes_tjmt$p[2]` dos processos. Outras grandes companhias de telefonia também se destacam nas 10 primeiras posições, são elas: 4,5 e 10.

Ainda nos 10 maiores litigantes destacam-se duas empresas. A primeira é a concessionária Energisa, com `r maiores_litigantes_tjmt$p[3]` dos processos, assumindo assim a terceira posição. Essa empresa é a única concessionária presente na lista dos 30 maiores, embora o estado do Mato Grosso apareça na 25ª posição.

O outro destaque foi da seguradora Líder, administradora do seguro DPVAT, com 3,26% dos litígios. Essa empresa não aparece na lista dos outros tribunais e, como uma outra dissonância, também nota-se a ausência de empresas administradoras de cadastro de inadimplentes nas 30 maiores. Essa ocorrência também destoa do observado em outros tribunais.

```{r}
head(maiores_litigantes_tjmt, 30) %>%
  knitr::knit_print(caption = "30 maiores litigantes da justiça consumerista do estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

Os 30 maiores litigantes acumulam `r maiores_litigantes_tjmt$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjmt$p_acum[5]` dos processos estão aglomerados nos setores financeiro, telecomunicações, seguros, concessionárias de serviços básicos e transporte aéreo. As duas primeiras classes possuem proporções acima de 20% dos processos e caracterizam um ponto de corte na distribuição de processos por empresa: a partir delas, a fatia consumida por cada instituição orbita os 1%. Nessa nova classe de processos, cujas demandadas concentram menos de 20% do total, se destacam as concessionárias de serviços básicos, como energia, gás, água e esgoto, transporte aéreo e seguros, com 7,7%, 1,8% e 9,2% dos processos, respectivamente.

```{r}
maiores_setores_tjmt %>%
  head(5) %>%
  knitr::knit_print(caption = "5 setores da economia com maior quantidade de litígios consumeristas no estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

<!-- Considerando-se o interesse em qualificar certas instituições como demandadas em massa pelos litigantes, idealmente partiríamos a umoa análise que busca averiguar a existência de padrões temporais que expliquem o volume de casos de um certo grande litigante levantado nas tabelas anteriores. Entretanto, o mecanismo de obtenção dos dados não permite que essas perguntas sejam respondidas, pois o número esperado de processos é inversamente proporcional à sua idade, já que o CNJ recebeu apenas aqueles processos que ainda estavam ativos, de tal forma que processos mais velhos vão custar mais a aparecer. -->

<!-- ```{r} -->
<!-- d_tjmt_2 %>%  -->
<!--   filter(data_dist > as.Date('2009-01-01')) %>%  -->
<!--   count(mes, area) %>%  -->
<!--   filter(area %in% head(maiores_setores_tjmt,10)$area) %>%  -->
<!--   ggplot(aes(x = mes, y = n)) + -->
<!--   geom_line() + -->
<!--   facet_wrap(~area, ncol = 4, nrow = 3, scale = 'free') + -->
<!--   theme_bw() -->
<!-- ``` -->

<!-- De toda forma, os gráficos encontrados não sugerem que algum setor específico da economia esteja sendo representados por processos relacionados a algum período específico. -->

### Causas de pedir

Nesta seção estudamos as causas de pedir mais frequentes contra os maiores litigantes do TJMT, separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjmt_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  distinct(selo_processo_numero_unico, .keep_all = T) %>%
  count(assunto_nome) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_bancos <- d_tjmt_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  filter(area == "bancos_cartoes_financeiras") %>%
   {{numero_de_processos_contra_bancos <<- length(unique(.$selo_processo_numero_unico))
  .}} %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/numero_de_processos_contra_bancos,
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Com relação às causas de pedir, a maior parte dos processos contra instituições financeiras trata de indenizações por danos morais, com `r assuntos_bancos$p[1]` dos processos.  Essa é uma classificação geral e, segundo a TPU, admite duas ramificações: "Inclusão Indevida em Cadastro de Inadimplentes" e "Protesto Indevido de Título".

```{r}
assuntos_bancos %>%
  head(10) %>%
  knitr::knit_print(caption = "10 causas de pedir consumeristas mais comuns contra instituições financeiras no estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

Os processos referentes a inclusões indevidas no cadastro de inadimplentes aparecem como a terceira causa mais frequente dos processos contra instituições bancárias, representando `r assuntos_bancos$p[3]`. É razoável assumir que o assunto 'inclusões indevidas no cadastro de inadimplentes' esteja sub-representando a classificação, pois a frequência desse sugere que muitas indenizações por danos morais estejam classificadas incorretamente.

Com relação aos serviços prestados pelos bancos, o segundo assunto mais frequente é "Interpretação/ Revisão de Contrato", com `r assuntos_bancos$p[2]` dos litígios.

Condizente com o fato das empresas de seguros serem litigantes relevantes na justiça estadual do Mato Grosso, a quarta causa mais frequente dos processos contra instituições bancárias é "Seguros", com `r assuntos_bancos$p[4]` dos processos. Segundo a TPU, processos com essa classificação só poderiam ser ajuizados contra seguradoras, mas é comum que grandes conglomerados financeiros também forneçam esse tipo de serviço.

A quinta causa mais frequente dos processos contra instituições bancárias é a classificação geral "Bancários", com `r assuntos_bancos$p[6]` dos casos. Segundo a Tabela Processual Unificada, esse vértice deriva três outros assuntos possíveis: "Empréstimo Consignado","Expurgos Inflacionários ou Planos Econômicos" e "Tarifas". Expurgos Inflacionários, inclusive, aparece na sétima posição, com `r assuntos_bancos$p[7]` dos processos.

A sexta causa de pedir mais comum contra instituições bancárias envolve Indenizações por Danos Materiais, com `r assuntos_bancos$p[5]` dos litígios. Segundo a TPU, esse assunto é uma especialização da classificação geral "Responsabilidade do Fornecedor", que figura como a oitava posição no ranqueamento dos assuntos mais comuns, representando `r assuntos_bancos$p[8]` dos processos.

#### Empresas de telecomunicações

```{r}
telecomunicaoes <- d_tjmt_2 %>%
  filter(area == "telecomunicacoes") %>%
  distinct(selo_processo_numero_unico, .keep_all = T) %>%
  count(assunto_nome) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_telecomunicacoes <- d_tjmt_2 %>%
  filter(area == "telecomunicacoes") %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  {{numero_de_processos_contra_tel <<- length(unique(.$selo_processo_numero_unico))
  .}} %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/numero_de_processos_contra_tel,
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

No segmento das telecomunicações, as 4 maiores companhias de telefonia do Brasil concentram mais de 90% dos processos. Se considerarmos ainda as operadoras de televisão, esse número sobe para 98,9%.

```{r}
maiores_telecomunicacoes %>%
  head(7) %>%
  knitr::knit_print(caption = "7 maiores litigantes consumeristas do setor das telecomunicações no estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

Os processos mais frequentes contra empresas de telefonia pedem indenizações por danos morais, representando `r telecomunicaoes$p[1]` dos litígios. Logo em seguida, mas não sem relação, vêm os casos relacionados a inclusão indevida em cadastro de inadimplentes, com `r telecomunicaoes$p[2]` dos casos. Se consideramos que muitos processos por danos morais podem ser oriundos de inclusões indevidas em cadastro de inadimplentes, conclui-se dessas duas observações que aproximadamente 87,3% dos processos contra empresas de telefonia estão relacionados a esse tema. Se contabilizarmos os casos "Responsabilidade do Fornecedor" e "Indenização por Dano Material" sob este mesmo tópico, essa cifra sobre para 93,5% do total.

```{r}
telecomunicaoes %>%
  head(10) %>%
  knitr::knit_print(caption = "10 maiores causas de pedir consumeristas do setor de telecomunicações no estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

Uma parte minoritária dos processos contra empresas de telefonia no Mato Grosso está relacionado a problema com o serviço propriamente dito. Esses casos somam aproximadamente 5% do total, e estão distribuídos majoritariamente nos assuntos Telefonia, uma classificação geral da TPU com `r telecomunicaoes$p[5]` casos, Contratos de Consumo, com `r telecomunicaoes$p[6]` dos casos, Interpretação e Revisão de Contrato, com `r telecomunicaoes$p[7]`, e Cobrança indevida de ligações, com `r telecomunicaoes$p[8]`.

#### Empresas de seguros

```{r}
seguros <- d_tjmt_2 %>%
  filter(area == "seguros") %>%
  distinct(selo_processo_numero_unico, .keep_all = T) %>%
  count(assunto_nome) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_seguros <- d_tjmt_2 %>%
  filter(area == "seguros") %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  {{numero_de_processos_contra_tel <<- length(unique(.$selo_processo_numero_unico))
  .}} %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Os processos contra empresas de seguros são polarizados, as duas maiores demandadas são a Porto Seguro e a seguradora Líder, com 48,7% e 30,8% dos litígios, respectivamente. Desconsiderando essas instituições, observa-se uma pulverização dos processos dentre as demais seguradoras.

```{r}
maiores_seguros %>%
  head(10) %>%
  knitr::knit_print(caption = "10 companhias de seguros com maior quantidade de litígios consumeristas no estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

Em relação aos assuntos, por outro lado, não há pulverização. Processos denominados "Seguro" dominam 87,3% dos casos, enquanto 10,9% dos processos discutem indenizações por danos morais e materiais, totalizando assim 98,3% dos processos.

```{r}
seguros %>%
  head(10) %>%
  knitr::knit_print(caption = "10 causas de pedir consumeristas contra companhias de seguros mais frequentes no estado do Mato Grosso. Fonte: Selo Justiça em Números.")
```

O que se observa, no entanto, é uma variação nas proporções de cada assunto de acordo com cada litigante. Enquanto os litígios contra a Porto Seguro e a administradora Líder possuem processos no assunto "Seguros" em quantidade muito maior do que os demais, a situação não se repete nos processos contra a Mapfre e a SulAmérica.

```{r, fig.cap = "Distribuição dos assuntos processuais nas 4 maiores litigantes consumeristas dentre companhias de seguros do estado do Mato Grosso. Fonte: Selo Justiça em Números."}
d_tjmt_2 %>%
  distinct(selo_pessoa, selo_processo_numero_unico, .keep_all = T) %>%
  filter(area == "seguros",
         assunto_nome %in% seguros$assunto_nome[1:3],
         nome2 %in% maiores_seguros$nome2[1:4]) %>%
  mutate(area = fix_labels(area),
         nome2 = fix_labels(nome2),
         assunto_nome = fix_labels(assunto_nome)) %>%
  count(nome2, assunto_nome) %>%
  group_by(nome2) %>%
  mutate(p = n/sum(n)) %>%
  ggplot(aes(x = assunto_nome, y = p)) +
  geom_bar(stat = 'identity') +
  scale_y_continuous(labels = scales::percent) +
  facet_wrap(~nome2, nrow = 2, ncol = 2) +
  theme_minimal() +
  coord_flip() +
  labs(x = 'Causa de pedir (Assunto)', y = 'Número de processos')
```

## TJDFT

```{r}
# d_tjdft <- readRDS("data-raw/base_filtrada_apenas_consumeristas_tjdft.rds") %>%
#   filter(assunto_nome %in% assuntos_consumeristas_puros) %>%
#   mutate(nome2 = aggregate_major_companies(fix_nomes(selo_pessoa)),
#          area = market_segments(nome2))
#
# d_tjdft_2 <- d_tjdft %>%
#   filter(selo_pessoa_tipo == "JURIDICA",
#          str_detect(selo_nome_orgao_julgador,
#                     regex("Vara Especializada em Direito Banc[aá]rio|Vara Especializada Direito Banc[aá]rio|Vara C[íi]vel|Vara [Úu]nica|Juizado Especial C[íi]vel|Vara Criminal e C[íi]vel|Vara$|Vara Especializada Ação Civil Pública e Ação Popular|VARA ESP. AÇÃO CIVIL PÚBLICA E AÇÃO POPULAR|Juizado Especial($| [(]Projudi[)] )|Vara Especializada dos Juizados Especiais", ignore_case = T)),
#          selo_pessoa_polo == "PA") %>%
#   mutate(data_dist = as.Date(
#     as.numeric(stringr::str_sub(selo_data_de_ajuizamento, 1,5)), origin = '1899-12-30'),
#          mes = lubridate::floor_date(data_dist, 'months'),
#          ano = lubridate::year(data_dist))

d_tjdft_2 <- readRDS("data-raw/d_tjdft_2.rds")
numero_de_processos <- d_tjdft_2$selo_processo_numero_unico %>% unique %>% length
```

Conforme mencionado na seção de metodologia, o Tribunal de Justiça do Distrito Federal forneceu os dados referentes ao Selo Justiça em Números. Nesta seção descrevemos os resultados obtidos nesse estado.

### Os maiores litigantes do Mato Grosso

```{r, echo = F}
maiores_litigantes_tjdft <- d_tjdft_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/numero_de_processos),
    p_acum = scales::percent(cumsum(n)/numero_de_processos))

maiores_setores_tjdft <- d_tjdft_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  count(area) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Assim como identificado nos demais estados, a empresa com maior número de processos no Distrito Federal foi uma empresa de telefonia, a companhia Claro, com `r maiores_litigantes_tjdft$p[1]` dos litígios. Nas duas próximas posições, seguem Oi e Vivo, com `r maiores_litigantes_tjdft$p[2]` e `r maiores_litigantes_tjdft$p[3]` dos litígios, respectivamente. Apenas a partir da quarta posição aparece uma instituição bancária: o Banco Bradesco, com um total de `r maiores_litigantes_tjdft$p[4]` dos processos.

Ainda nos 10 primeiros maiores litigantes, destaca-se a presença de companhias aéreas, como a Gol e a Tam com `r maiores_litigantes_tjdft$p[7]` e `r maiores_litigantes_tjdft$p[8]` dos processos, o que não foi identificado em nenhum outro tribunal.

```{r}
head(maiores_litigantes_tjdft, 30) %>%
  knitr::knit_print(caption = "30 maiores litigantes da justiça consumerista do Distrito Federal. Fonte: Selo Justiça em Números.")
```

Os 30 maiores litigantes acumulam `r maiores_litigantes_tjdft$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjdft$p_acum[5]` dos processos concentram-se no setores financeiro, telecomunicações, seguros, transportes aéreos e planos de saúde. As cinco primeiras classes possuem proporções acima de 3% dos processos e caracterizam um ponto de corte na distribuição de processos por empresa: a partir delas, a fatia consumida por cada instituição orbita os 1%.

```{r}
maiores_setores_tjdft %>%
  head(5) %>%
  knitr::knit_print(caption = "5 setores econômicos com maior quantidade de processos consumeristas no Distrito Federal. Fonte: Selo Justiça em Números.")
```

<!-- Considerando o interesse em qualificar certas instituições como demandadas em massa pelos litigantes, idealmente partiríamos a uma análise que busca averiguar a existência de padrões temporais que expliquem o volume de casos de um certo grande litigante levantado nas tabelas anteriores. Entretanto, o mecanismo de obtenção dos dados não permite que essas perguntas sejam respondidas, pois o número esperado de processos é inversamente proporcional à sua idade, já que o CNJ recebeu apenas aqueles processos que ainda estavam ativos, de tal forma que processos mais velhos vão custar mais a aparecer. -->

<!-- ```{r} -->
<!-- d_tjdft_2 %>%  -->
<!--   #filter(data_dist > as.Date('2009-01-01')) %>%  -->
<!--   count(mes, area) %>%  -->
<!--   filter(area %in% head(maiores_setores_tjdft,10)$area) %>%  -->
<!--   ggplot(aes(x = mes, y = n)) + -->
<!--   geom_line() + -->
<!--   facet_wrap(~area, ncol = 4, nrow = 3, scale = 'free') + -->
<!--   theme_bw() -->
<!-- ``` -->

<!-- De toda forma, os gráficos encontrados sugerem a existência de uma uma anomaria nos processos contra agências de viagem no final de 2015, enquanto as demais séries não permitem nenhuma afirmação contundente por conta do viés de seleção da base. -->

### Causas de pedir

Nesta seção estudamos as causas de pedir mais frequentes contra os maiores litigantes do TJDFT, separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjdft_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  distinct(selo_processo_numero_unico, .keep_all = T) %>%
  count(assunto_nome) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_bancos <- d_tjdft_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  filter(area == "bancos_cartoes_financeiras") %>%
         {{numero_de_processos_contra_bancos <<- length(unique(.$selo_processo_numero_unico))
  .}} %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Com relação às causas de pedir, a maior parte dos processos contra instituições financeiras trata de indenizações por danos morais, com `r assuntos_bancos$p[1]` dos processos.  Essa é uma classificação geral e, segundo a TPU, admite duas ramificações: "Inclusão Indevida em Cadastro de Inadimplentes" e "Protesto Indevido de Título". É razoável observar que o erro de classificação pode ou não considerar a hierarquia da Tabela, mas também é razoável imaginar que muitos processos por danos morais contra uma instituição bancária estejam relacionados a cadastros indevidos em bases de inadimplentes.

De fato, os processos referentes a inclusões indevidas no cadastro de inadimplentes aparecem como a terceira causa mais frequente dos processos contra instituições bancárias, com `r assuntos_bancos$p[3]` dos processos. A classificação "Instituições Bancárias" é precedida pela classificação geral "Bancários", com `r assuntos_bancos$p[2]` dos casos. Segundo a Tabela Processual Unificada, esse vértice deriva três outros assuntos possíveis "Empréstimo Consignado","Expurgos Inflacionários ou Planos Econômicos" e "Tarifas", mas o erro de classificação pode ou não considerar essa estrutura.

A quarta causa de pedir mais comum contra instituições bancárias envolve Indenizações por Danos Materiais, com `r assuntos_bancos$p[4]` dos litígios. Com aproximadamente a mesma proporção do total de processos, segue a classificação "Cartão de Crédito, com `r assuntos_bancos$p[5]`. Essa é uma das classificações ambíguas da TPU e que aparece duas vezes, uma no Direito do Consumidor e outra no Direito Civil. Em ambos os casos os dispositivos legais às classificações processuais incluem o Código de Defesa do Consumidor.

A sexta causa mais frequente dos processos contra instituições bancárias é a classificação "Abatimento proporcional do preço", com `r assuntos_bancos$p[6]` dos casos. Essa posição no ranking delimita uma mudança na distribuição dos processos: a partir deste assunto, as próximas causas de pedir não passam de 3%.

As próximas 4 causas mais frequentes discutem eventuais ilícitos relativos aos serviços prestados pelas instituições financeiras: empréstimos consignados, consórcios, contratos e seguros. Juntas, as dez maiores causas de pedir contra instituições financeiras abarcam mais de 90% dos litígios contra bancos e instituições financeiras.

#### Empresas de telecomunicações

```{r}
telecomunicaoes <- d_tjdft_2 %>%
  filter(area == "telecomunicacoes") %>%
  distinct(selo_processo_numero_unico, .keep_all = T) %>%
  count(assunto_nome) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_telecomunicacoes <- d_tjdft_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  filter(area == "telecomunicacoes") %>%
  {{numero_de_processos_contra_bancos <<- length(unique(.$selo_processo_numero_unico))
  .}} %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

No segmento das telecomunicações, as 4 maiores empresas de telefonia concentram mais de 85% dos processos. Se considerarmos ainda as operadoras de televisão, esse número sobe para 97,2%.

```{r}
maiores_telecomunicacoes %>%
  head(6) %>%
  knitr::knit_print("6 maiores litigantes consumeristas do setor de telecomunicações no Distrito Federal. Fonte: Selo Justiça em Números.")
```

Os processos mais frequentes contra empresas de telefonia pedem indenizações por danos morais, representando `r telecomunicaoes$p[1]` dos litígios. Posteriormente, mas não sem relação, na terceira posição vêm os casos relacionados a inclusão indevida em cadastro de inadimplentes, representando `r telecomunicaoes$p[3]` dos processos.

A parte dos casos em que se trata de condenações por cadastros indevidos, uma grande parcela dos processos trata de problemas nos serviços de telefonia. Esses casos somam aproximadamente 20% dos processos, e estão distribuídos majoritariamente nos assuntos Telefonia, uma classificação geral da TPU, com `r telecomunicaoes$p[2]` dos casos, rescisão de contrato e devolução de dinheiro com `r telecomunicaoes$p[5]` dos casos, cobranças indevidas de ligações com `r telecomunicaoes$p[6]` dos processos, e práticas abusivas e assinatura básica mensal, que juntas somam com 5% dos casos.

```{r}
telecomunicaoes %>% 
  head(10) %>% 
  knitr::knit_print(caption = "10 causas de pedir consumeristas contra empresas de telefonia mais frequentes no Distrito Federal. Fonte: Selo Justiça em Números.")
```

#### Companhias de Transporte Aéreo

```{r}
transporte_aereo <- d_tjdft_2 %>%
  filter(area == "transporte_aereo") %>%
  distinct(selo_processo_numero_unico, .keep_all = T) %>%
  count(assunto_nome) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_transporte_aereo <- d_tjdft_2 %>%
  distinct(selo_processo_numero_unico, selo_pessoa, .keep_all = T) %>%
  filter(area == "transporte_aereo") %>%
  {{numero_de_processos_contra_bancos <<- length(unique(.$selo_processo_numero_unico))
  .}} %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Os processos contra companhias aéreas no distrito federal se concentram basicamente em duas instituições: Gol e Tam e acumulam 96% dos processos.

Embora um pouco mais pulverizada, a distribuição de assuntos dos processos contra companhias aéreas se dividem em dois grupos majoritários: indenizações por danos morais ou materiais, com aproximadamente 60% dos casos, e processos que versam especificamente sobre o serviço prestado, que somam aproximadamente 40% dos processos.

```{r}
head(transporte_aereo, 10) %>%
  knitr::knit_print(caption = "10 causas de pedir consumeristas contra companhias aéreas mais frequentes no Distrito Federal. Fonte: Selo Justiça em Números.")
```

No grupo de processos específicos sobre os serviços prestados, 7,9% deles foram classificados no assunto "Transporte Aéreo", uma classificação genéria das TPU's, que abarcam processos sobre acidentes aéreos, atrasos de voos, cancelamentos de voos, extravios de bagagem e overbooking. Essas classificações mais específicas aparecem nas posições seguintes no ranking, sendo os acidentes aéreos as causas de pedir mais frequentes, com 4,7% dos casos. Logo em seguida tem-se os atrasos de voos, com 4,2% dos casos, seguido de perto pelos cancelamentos, com 3,7% dos processos e extravios de bagagem, com 2,7%.

## TJBA

```{r}
library(tidyverse)
#
# d_tjba <- read_rds('data-raw/d_tjba.rds') %>%
#     mutate(nome2 = aggregate_major_companies(fix_nomes(reu)),
#     area = market_segments(nome2))
#
# d_tjba_2 <- d_tjba %>%
#   mutate(mes = lubridate::floor_date(dt_dist, 'months'),
#     ano = lubridate::year(dt_dist),
#     area = market_segments(nome2)) %>%
#   filter(stringr::str_trim(assunto) %in% stringr::str_trim(assuntos_consumeristas_puros)) %>%
#   filter(dt_dist >= as.Date('2010-01-01'),
#          dt_dist < as.Date('2015-11-01'))
#
d_tjba_2 <- readRDS('data-raw/d_tjba_2.rds') %>%
  filter(!is.na(area))
```

Conforme mencionado na seção de metodologia, não foi possível obter dados do Tribunal de Justiça da Bahia entrando em contato direto com o Tribunal. Portanto, os dados desta seção foram obtidos utilizando ferramentas de extração automática de informações do site do tribunal.

### Os maiores litigantes do tribunal da Bahia

```{r, echo = F}
maiores_litigantes_tjba <- d_tjba_2 %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))

maiores_setores_tjba <- d_tjba_2 %>%
  count(area) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Destoando do que foi identificado nos demais estados, nenhuma empresa de telefonia figura na lista dos 10 maiores litigantes da justiça consumerista baiana. Por outro lado, como é comum, as instituições financeiras compõem a maior parte dentre as 10 posições no ranking: o primeiro lugar é do grupo empresarial do Banco Bradesco, com `r maiores_litigantes_tjba$p[1]` dos processos, e o segundo maior litigante é o grupo de empresas ligadas ao Banco Itaú, compondo `r maiores_litigantes_tjba$p[1]` dos litígios.

```{r}
maiores_litigantes_tjba %>%
  head(30) %>%
  knitr::knit_print(caption = "30 maiores litigantes consumeristas do estado da Bahia. Fonte: Elaboração própria.")
```

No Tribunal de Justiça da Bahia, os 30 maiores litigantes acumulam `r maiores_litigantes_tjba$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjba$p_acum[5]` dos processos concentram-se no setores financeiro, seguros, telecomunicações, fornecimento de energia e água, e, em quinto lugar, o governo do estado da Bahia. Os dois primeiros setores econômicos dominam os demais, tomando 67% do total dos casos, mas o que efetivamente chama a atenção são os casos contra o governo do estado.

```{r}
maiores_setores_tjba %>%
  head(5) %>%
  knitr::knit_print(caption = "5 setores econômicos com maior quantidade de processos consumeristas no estado da Bahia. Fonte: Elaboração própria.")
```

Ao investigar esse caso específico, observamos que os processos contra o governo do estado não aconteceram isolados em um certo período, mas sim com regularidade ao longo dos anos.

Realizando a mesma análise para os demais setores, notou-se que a estabilidade é um traço comum das curvas de volumes processuais dos maiores litigantes da Bahia. A única exceção à regra está nos processos contra bancos e demais instituições financeiras, pois apresentam um declínio na quantidade semestral de processos entre 2013 e 2015.

```{r, fig.cap = "Volume processual dos processos consumeristas nos quatro maiores setores econômicos do estado da Bahia. Fonte: Elaboração própria."}
d_tjba_2 %>%
    mutate(semestre = lubridate::floor_date(dt_dist, 'half-year')) %>%
    count(semestre, area) %>%
    filter(area %in% head(maiores_setores_tjba,5)$area) %>%
    mutate(area = fix_labels(area)) %>%
    ggplot(aes(x = semestre, y = n)) +
    geom_line(linetype = 2) +
    geom_point() +
    facet_wrap(~area, ncol = 2, nrow = 3, scale = 'free') +
    theme_minimal() +
    labs(x = 'Semestre de distribuição', y = 'Número de processos distribuídos')
```

### Causas de pedir

Nesta seção estudamos as causas de pedir mais frequentes contra os maiores litigantes do TJBA, separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjba_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_bancos <- d_tjba_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Ao contrário do identificado no Mato Grosso e Distrito Federal, os processos por danos morais e materiais não aparecem no primeiro lugar da lista de maiores causas de pedir da Bahia. O assunto mais frequente foi "Interpretação / Revisão de Contrato", com `r assuntos_bancos$p[1]` dos contratos.

O primeiro resultado consonante com o identificado nos demais tribunais apareceu apenas na segunda posição. "Inclusão Indevida em Cadastro de Inadimplentes" concentra `r assuntos_bancos$p[2]` e é uma das classificações específicas do assunto "Indenização por Dano Moral", que apareceu diversas vezes nos demais tribunais.

As compensações por danos morais e materiais propriamente ditas aparecem apenas nas posições 5 e 6, e somam apenas 6,4% do total de processos.

```{r}
head(assuntos_bancos, 10) %>%
  knitr::knit_print(caption = "10 causas de pedir consumeristas recorrentes contra o setor bancário e financeiro no estado da Bahia. Fonte: Elaboração própria.")
```

#### Companhias de seguros

```{r}
assuntos_seguros <- d_tjba_2 %>%
  filter(area == "seguros") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_seguros <- d_tjba_2 %>%
  filter(area == "seguros") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Na justiça estadual baiana, 5 companhias de seguros concentram mais de 90% dos processos.

```{r}
maiores_litigantes_seguros %>%
  head(5) %>%
  knitr::knit_print(caption = "5 companhias de seguros com maior quantidade de processos consumeristas no estado da Bahia. Fonte: Elaboração própria.")
```

Seguindo essa concentração, aproximadamente 90% dos processos contra companhias de seguros tem assunto processual "Seguro". Todos os demais assuntos concentram no máximo 5,4% dos processos, sendo esse máximo atingido pelos processos com assunto "Planos de Saúde".

```{r}
assuntos_seguros %>%
  knitr::knit_print(caption = "12 causas de pedir consumeristas mais comuns no estado da Bahia. Fonte: Elaboração própria.")
```

#### Companhias de telecomunicações

```{r}
telecomunicacoes <- d_tjba_2 %>%
  filter(area == "telecomunicacoes") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_telecom <- d_tjba_2 %>%
  filter(area == "telecomunicacoes") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

As 4 maiores empresas de telefonia brasileiras concentram mais do que 90% dos processos consumeristas.

```{r}
maiores_litigantes_telecom %>%
  head(4) %>%
  knitr::knit_print(caption = "4 maiores litigantes do setor das telecomunicações do estado da Bahia. Fonte: Elaboração própria.")
```

As três primeiras causas de pedir, com `r telecomunicacoes$p_acum[3]` do total dos processos, estão mais próximas do identificado nos outros tribunais. Ao contrário do que observou-se nas instituições bancárias desse estado, as matérias mais frequentes versam sobre inclusões indevidas em cadastro de inadimplentes e indenizações por danos morais ou materiais.

## TJAM

```{r}
library(tidyverse)
#
# d_tjam <- read_rds('data-raw/d_tjam.rds') %>%
#     mutate(nome2 = aggregate_major_companies(fix_nomes(reu)),
#     area = market_segments(nome2))
#
# d_tjam_2 <- d_tjam %>%
#   mutate(mes = lubridate::floor_date(dt_dist, 'months'),
#     ano = lubridate::year(dt_dist),
#     area = market_segments(nome2)) %>%
#   filter(stringr::str_trim(assunto) %in% stringr::str_trim(assuntos_consumeristas_puros)) %>%
#   filter(dt_dist >= as.Date('2010-01-01'),
#          dt_dist < as.Date('2015-11-01'))

d_tjam_2 <- readRDS("data-raw/d_tjam_2.rds")
```


Conforme mencionado na seção de metodologia, não foi possível obter dados do Tribunal de Justiça do Amazonas entrando em contato direto com o Tribunal. Portanto, os dados desta seção foram obtidos utilizando ferramentas de extração automática de informações do site do tribunal.

### Os maiores litigantes do tribunal do Amazonas

```{r, echo = F}
maiores_litigantes_tjam <- d_tjam_2 %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))

maiores_setores_tjam <- d_tjam_2 %>%
  count(area) %>%
  arrange(desc(n)) %>%
  mutate(p = scales::percent(n/sum(n)),
    p_acum = scales::percent(cumsum(n)/sum(n)))
```

Ao contrário de todos os tribunais deste estudo, a empresa com maior quantidade de processos consumeristas no estado do Amazonas foi uma empresa de fornecimento de água, a Manaus Ambiental, com `r maiores_litigantes_tjam$p[1]` dos processos. As posições seguintes são mais condizentes com o identificado nos outros tribunais, sendo duas delas instituições bancárias, que contemplam 14,7% dos casos, e uma delas a seguradora Líder, administradora do seguro DPVAT, com `r maiores_litigantes_tjam$p[3]` dos litígios.

```{r}
head(maiores_litigantes_tjam, 30) %>%
  knitr::knit_print(caption = "30 maiores litigantes da justiça consumerista do estado do Amazonas. Fonte: Elaboração própria.")
```

A quinta posição também surpreendeu, pois trata-se de uma empresa de fornecimento de energia subsidiária da Eletrobras, a Amazonas Energia, com `r maiores_litigantes_tjam$p[5]` dos processos. As demandadas mais usuais do direito consumerista brasileiro, as empresas de telefonia, só começam a aparecer da sexta posição em diante. O grupo empresarial da Oi concentra `r maiores_litigantes_tjam$p[6]` dos processos na sexta posição, o grupo empresarial da Vivo concentra `r maiores_litigantes_tjam$p[7]` dos processos na sétima posição, e o grupo de empresas da Claro concentra `r maiores_litigantes_tjam$p[8]` dos processos na nona posição.

Os 30 maiores litigantes acumulam `r maiores_litigantes_tjam$p_acum[30]`, mas pudemos compreender melhor a origem dos demais litígios ao agruparmos os processos por setor da economia das demandadas. Analisando dessa forma, concluímos que `r maiores_setores_tjam$p_acum[5]` dos processos estão no setores financeiro, fornecimento de energia e água, telecomunicações, seguros e transporte aéreo. Os três primeiros setores abarcam proporções acima de 8% dos processos e caracterizam um ponto de corte na distribuição de processos por empresa: a partir delas, a fatia consumida por cada instituição orbita os 1%. Nesses setores, aqueles em que as demandadas concentram menos de 8% do total, destaca-se o fundo Itapeva, que realiza cobranças de crédito.

```{r}
maiores_setores_tjam %>%
  head(5) %>%
  knitr::knit_print(caption = "5 setores econômicos mais frequentes na justiça consumerista do estado do Amazonas. Fonte: Elaboração própria.")
```

Considerando o interesse em qualificar certas instituições como demandadas em massa pelos litigantes, partimos para uma análise a fim de averiguar a existência de padrões temporais explicativos para o volume de casos de um certo grande litigante levantado nas tabelas anteriores.

Foi possível identificar padrões temporais analisando o volume mensal de distribuições de cada tipo de processo. Existe uma tendência de crescimento dos processos contra as empresas de fornecimento de água e esgoto e um sensível aumento no volume processual das empresas de telefonia no ano de 2015. Nas empresas de seguros e instituições financeiras, por outro lado, ocorre exatamente o contrário. O volume processual concentrado nessas instituições encontra-se em declínio.

```{r, fig.align = "Volume processual consumerista ao longo dos anos nos 5 setores econômicos com maior quantidade de processos. Fonte: Elaboração própria."}
d_tjam_2 %>%
    count(mes, area) %>%
    filter(area %in% head(maiores_setores_tjam,5)$area) %>%
    mutate(area = fix_labels(area)) %>%
    ggplot(aes(x = mes, y = n)) +
    geom_line() +
    facet_wrap(~area, ncol = 2, nrow = 3, scale = 'free') +
    theme_minimal() +
    labs(x = "Semestre de distribuição", y = "Número de processos distribuídos")
```

### Causas de pedir

Nesta seção estudamos as causas de pedir mais frequentes contra os maiores litigantes, separando-os de acordo com a área em que atuam.

#### Bancos e Instituições Financeiras

```{r}
assuntos_bancos <- d_tjam_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_litigantes_bancos <- d_tjam_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

No TJAM, 5 assuntos da TPU contemplam `r assuntos_bancos$p_acum[5]` do total de processos consumeristas contra bancos e instituições financeiras.

Com relação às empresas financeiras, o assunto mais frequente, com `r assuntos_bancos$p[1]` dos processos, diz respeito à "Interpretação / Revisão de Contrato". Em seguida vemos a classificação genérica "Indenização por Dano Moral", com `r assuntos_bancos$p[2]` dos processos, sucedida por processos de "Indenização por Dano Material", com `r assuntos_bancos$p[3]` dos processos.

```{r}
assuntos_bancos %>%
  head(10) %>%
  knitr::knit_print(caption = "10 causas de pedir consumeristas contra instituições financeiras mais frequentes no estado do Amazonas. Fonte: Elaboração própria.")
```


Na quarta posição aparece a "Inclusão Indevida em Cadastro de Inadimplentes", com `r assuntos_bancos$p[4]` dos processos, que se relaciona com os dois últimos assuntos listados. A quinta posição diz respeito a processos relativos ao uso de cartões de crédito e concentra `r assuntos_bancos$p[5]` dos processos.

<!-- Neste ponto já se acumula 80% de todos os processos consumeristas contra instituições bancárias, mas dois assuntos processuais ainda se destacam, considerando que o resto da lista lida com temas repetidos ou aninhados dentro de classificações mais gerais como "Bancários". -->

Embora os 6 primeiros assuntos processuais mais frequentes sejam expressivos, pois junto concentram mais de 80% dos processos, o volume processual de um deles se concentrou num certo período do tempo. Processos classificados como "Interpretação / Revisão de Contrato" apresentaram um decaimento constante a partir de 2014, de tal forma que processos desse assunto só foram distribuídos entre 2012 e 2014. Processos de danos morais e classificados como "Bancários" também foram distribuídos com menor frequência a partir de 2014, mas indenizações por danos materiais, processos relacionados a cartões de crédito e inclusões indevidas em cadastros de inadimplentes aumentaram.

```{r}
d_tjam_2 %>%
  filter(area == "bancos_cartoes_financeiras") %>%
  filter(assunto %in% assuntos_bancos$assunto[1:6]) %>%
  count(mes, assunto) %>%
  mutate(assunto = fix_labels(assunto)) %>%
  ggplot(aes(x = mes, y = n, color = assunto)) +
  geom_line() +
  theme_minimal() +
  theme(strip.background = element_blank(),
        strip.placement = 'outside',
        strip.text = element_blank(),
        legend.position = 'bottom') +
  labs(x = "Mês de distribuição", y = "Número de processos distribuídos")
```

#### Empresas de telecomunicações

```{r}
telecomunicaoes <- d_tjam_2 %>%
  filter(area == "telecomunicacoes") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_telecomunicacoes <- d_tjam_2 %>%
  filter(area == "telecomunicacoes") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

O tópico mais discutido em processos consumeristas contra companhias telefônicas é a inclusão indevida em cadastro de inadimplentes, com
`r telecomunicaoes$p[1]` dos processos. Logo em seguida, mas não sem relação, encontram-se os processos que pedem indenizações por danos morais, representando `r telecomunicaoes$p[2]` dos processos.

```{r}
telecomunicaoes %>%
  head(10) %>%
  knitr::knit_print(caption = "10 causas de pedir consumeristas contra companhias de telecomunicações mais comuns no estado do Amazonas. Fonte: Elaboração própria.")
```

Fora da seara das indenizações, a partir da terceira posição começam a aparecer processos efetivamente sobre a prestação de serviços das operadoras de telefonia. Os mais frequentes são aqueles que discutem cobranças indevidas de ligações, com `r telecomunicaoes$p[3]` dos casos. Na quarta posição, relacionado com os casos de danos morais e inclusões indevidas em cadastro de inadimplentes, estão os processos que pedem indenizações por danos materiais, representando `r telecomunicaoes$p[4]` dos casos.

Na quinta posição voltam a aparecer processos relacionados a prestação de serviços, com processos que têm a classificação genérica "Telefonia", que, segundo a TPU, deveriam ser classificados como "Assinatura Básica Mensal", "Cobrança Indevida de Ligações" ou "Pulsos Excedentes". Na sequência aparece uma dessas classificações específicas: processos do assunto "Assinatura Básica Mensal" representam `r telecomunicaoes$p[6]` dos casos.

#### Empresas de fornecimento gás e água

```{r}
energia <- d_tjam_2 %>%
  filter(area == "energia_gas_agua_esgoto") %>%
  count(assunto) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))

maiores_energia <- d_tjam_2 %>%
  filter(area == "energia_gas_agua_esgoto") %>%
  count(nome2) %>%
  arrange(desc(n)) %>%
  mutate(p = n/sum(n),
         p_acum = scales::percent(cumsum(p)),
         p = scales::percent(p))
```

Nesse setor, existem apenas duas empresas com volume processual expressivo: as companhias Amazonas Energia e Manaus Ambiental. Por esse motivo, apenas 5 assuntos processuais concentram `r energia$p_acum[5]` dos processos: "Fornecimento de Água", "Fornecimento de Energia Elétrica", "Inclusão Indevida em Cadastro de Inadimplentes", "Indenização por Dano Moral" e "Indenização por Dano Material".

```{r}
head(energia, 5) %>%
  knitr::knit_print(caption = "Causas de pedir contra concessionárias de serviços básicos mais frequentes no estado do Amazonas. Fonte: Elaboração própria.")
```

Por conta das diferenças nos serviços fornecidos por cada empresa, identifica-se entre elas uma distribuição desigual dos processos.

```{r, fig.cap = "Distribuição das causas de pedir das companhias concessionárias de serviços básicos separada por empresa. Fonte: Elaboração própria."}
d_tjam_2 %>%
  filter(area == "energia_gas_agua_esgoto",
         assunto %in% energia$assunto[1:5],
         nome2 %in% maiores_energia$nome2[1:2]) %>%
  mutate(nome2 = fix_labels(nome2),
         assunto = fix_labels(assunto)) %>%
  ggplot(aes(x = assunto)) +
  geom_bar() +
  facet_wrap(~nome2, nrow = 2, ncol = 2, scale = 'free') +
  theme_minimal() +
  coord_flip() +
  labs(x = "Número de processos", y = "Causa de pedir (Assunto)")
```

## SENACON {#results-senacon}

```{r}
library(tidyverse)
data(br_uf_map, package = 'abjData')
data(cadmun, package = 'abjData')
data(pnud_uf, package = 'abjData')
#se a gente quiser fazer filtros antes de produzir as listas, pode fazer isso no dataset_arrumado
# dataset_arrumado <- tidy_cnc %>% 
#   filter(dt_pena >= max(min(dt_cadastro),as.Date("2008-01-01")),
#          !assunto_penal_any)
# DEPRECATED. antes eu usava essa base pra tudo, agora é a de baixo

cadmun %<>% distinct(cod, uf) %>% mutate_all(as.character)
pnud_uf %<>% filter(ano == 2010) %>% 
  select(uf, ufn, popt) %>% 
  mutate(uf = as.character(uf)) %>% 
  inner_join(cadmun, c('uf' = 'cod')) %>% 
  select(id = uf.y, ufn, popt)
```


```{r}
# raw_data <- purrr::map_df(list.files("/home/fcorrea2/Área de Trabalho/Área de Trabalho/consumidor.gov/", full.names = T), ~data.table::fread(.x, encoding = "Latin-1", header = F))
# 
# d <- load_senacon(raw_data) %>% 
#       mutate(nome_fantasia_2 = aggregate_major_companies(fix_nomes(nome_fantasia)),
#        area = market_segments(nome_fantasia_2))

d <- readRDS('data-raw/d_senacon.rds')

library(tidyverse)
```

A secretaria Nacional de Atendimento ao Consumidor criou o site consumidor.gov em 2013 e já recebeu mais de `r "679.015"` reclamações nos seus quase 4 anos de duração. Nessa página, os consumidores podem entrar em contato direto com as prestadoras de serviço listadas na plataforma para resolver conflitos consumeristas, sem precisar recorrer às vias legais. Neste capítulo, mapeamos as principais queixas cadastradas e mensuramos o sucesso da plataforma à luz dos resultados obtidos nos tribunais.

### Métricas de acesso à plataforma

Pensando na plataforma como uma ferramenta extrajudicial de resolução de conflitos, o primeiro tópico a ser discutido é o seu acesso. Tratando-se de questões consumeristas, é razoável que a renda impacte a quantidade de acessos ao consumidor.gov. De fato, existem regiões da federação muito sub-representadas no que diz respeito à população, sendo os estados do norte e nordeste do país aqueles com a menor taxa de acessos.

```{r senacon_uf}
# detach('package:tidyverse')

# library(ggplot2)
# library(dplyr)
# library(stringr)

# d %>%
#   count(uf) %>%
#   rename(id = uf) %>%
#   inner_join(pnud_uf, by = 'id') %>%
#   mutate(n = 100000*n/popt) %>%
#   inner_join(br_uf_map, by = 'id') %>% {
#       ggplot(.) +
#         geom_map(aes(x = long, y = lat, map_id = id, fill = n),
#                  color = 'gray30', map = ., data = .) +
#         scale_fill_distiller(palette = 'PuRd', name = "Taxa/100mil\nhabitantes") +
#         coord_equal() +
#         theme_void() +
#         ggtitle("Taxa de reclamações ao consumidor.gov\npor Unidade da Federação")
#     }
```

![Taxa de reclamações ao consumidor.gov por Unidade da Federação.](imgs/mapa_senacon.pdf){#senacon_uf}

Pode-se argumentar que esse fato não é de grande valia para a mensuração que estamos fazendo, pois o mapa acima não considera nenhuma medida de distribuição de renda dentro das unidades da federação. Isso é relevante, pois sabe-se que a renda é um influenciador importante do acesso à justiça.

```{r}
# pibs <- rvest::html_session('https://pt.wikipedia.org/wiki/Lista_de_unidades_federativas_do_Brasil_por_PIB') %>%
#   rvest::html_table(fill = T) %>%
#   dplyr::nth(2) %>%
#   purrr::set_names(c('posicao','posicao_2','uf','pib_m','percentual')) %>%
#   filter(str_detect(posicao_2,'[0-9]')) %>%
#   mutate(pib = as.numeric(str_replace_all(pib_m, "\\.",""))/1000,
#          id = c('SP','RJ','MG','RS','PR','SC','BA','DF','GO','PE','ES','CE','PA','MT','AM',
#                 'MS','MA','RN','PB','AL','PI','SE','RO','TO','AC',"AP",'RR'))
# 
# d %>% 
#   count(uf) %>% 
#   rename(id = uf) %>% 
#   inner_join(pibs, by = 'id') %>% 
#   inner_join(pnud_uf, by = 'id') %>% 
#   mutate(n = 10*n/pib) %>% 
#   inner_join(br_uf_map, by = 'id') %>% {
#       ggplot(.) +
#         geom_map(aes(x = long, y = lat, map_id = id, fill = n),
#                  color = 'gray30', map = ., data = .) +
#         scale_fill_distiller(palette = 'PuRd', name = "Queixas/100mil\nR$ do PIB") + 
#         coord_equal() +
#         theme_void() +
#         ggtitle("Reclamações no consumidor.gov vs. PIB\npor Unidade da Federação") 
#     } 
```

![Taxa de reclamações ao consumidor.gov Unidade da Federação.](imgs/senacon_pib.pdf){#senacon_pib}

Refazendo a análise anterior e tomando como referência o Produto Interno Bruto da unidade da federação, os estados do Nordeste apresentam taxas próximas às taxas calculadas no Sul e Sudeste, mas um notável desnível se mantém na região norte do País. Enquanto a maior parte dos estados brasileiros apresenta a razão de uma queixa por cada 100 mil reais do PIB do estado, no Norte essa razão cai pela metade.

Também vale ressaltar que, embora os estados do Norte sistematicamente acessem menos o consumidor.gov, as taxas do Alagoas e Mato Grosso do Sul são comparáveis às taxas da região Norte.

```{r, results = 'asis'}
library(tidyverse)

pibs <- rvest::html_session('https://pt.wikipedia.org/wiki/Lista_de_unidades_federativas_do_Brasil_por_PIB') %>%
  rvest::html_table(fill = T) %>%
  dplyr::nth(2) %>%
  purrr::set_names(c('posicao','posicao_2','uf','pib_m','percentual')) %>%
  filter(str_detect(posicao_2,'[0-9]')) %>%
  mutate(pib = as.numeric(str_replace_all(pib_m, "\\.",""))/1000,
         id = c('SP','RJ','MG','RS','PR','SC','BA','DF','GO','PE','ES','CE','PA','MT','AM','MS','MA','RN','PB','AL','PI','SE','RO','TO','AC',"AP",'RR'))

d %>% 
  count(uf) %>% 
  rename(id = uf) %>% 
  inner_join(pibs, by = 'id') %>% 
  inner_join(pnud_uf, by = 'id') %>% 
  mutate(n = 10*n/pib) %>% 
  filter(id %in% c("AM","RO","PA","AP","RR","MS","AL")) %>% 
  select(id, n) %>% 
  set_names(c("UF","Reclamações por 100 mil reais do PIB")) %>% 
  knitr::knit_print(caption = "Reclamações por 100 mil reais do PIB separadas por unidade da federação. Fonte: SENACON.")
```

Além dos fatores geográficos e econômicos, também desejamos identificar se fatores temporais influenciam o número de reclamações encaminhadas à SENACON, a fim de verificar se o uso dessa ferramenta está crescendo, diminuindo ou estabilizando-se. Desconsiderando variações regionais, verificou-se que o número de reclamações ao consumidor.gov estão crescendo.

```{r fig.cap="Número de reclamações por mês. Fonte: SENACON."}
d %>% 
  mutate(mes = lubridate::floor_date(data_finalizacao, "months")) %>% 
  group_by(mes) %>% 
  count() %>% 
  ggplot(aes(x = mes,y = n)) +
  geom_line() +
  theme_minimal() +
  labs(x = 'Mês da reclamação', y = 'Número de reclamações')
```

Separando a sequência de consumos mensais por unidades da federação a conclusão é a mesma, com poucas exceções. Apenas nos estados do Acre, Tocantins e Sergipe observa-se uma curva diferente das demais. Nesses estados o padrão observado está mais próximo de uma reta com picos, no começo de 2015 no Acre e no final de 2016 em Sergipe e Tocantins.

```{r fig.cap="Número de reclamações por mês em cada UF. Fonte: SENACON.", fig.height=7}
d %>% 
  mutate(mes = lubridate::floor_date(data_finalizacao, "months")) %>% 
  group_by(uf, mes) %>% 
  count() %>% 
  ggplot(aes(x = mes,y = n)) +
  geom_line() +
  theme_minimal() +
  facet_wrap(~uf, ncol = 5, nrow = 6, scales = 'free') +
  labs(x = 'Mês da reclamação', y = 'Número de reclamações')
```

Como a procura pelo site depende apenas dos consumidores, informações pessoais sobre eles também são importantes para compreender qual tipo de público está mais suscetível a resolver litígios potenciais usando a ferramenta.

```{r}
p_mulher_maior_que_homem <- d %>% 
  count(sexo) %>% 
  with((max(n)-min(n))/sum(n)) %>% 
  scales::percent()
```

As informações sobre os usuários que são disponibilizadas publicamente pela Senacon são a faixa etária e o sexo e verificam-se padrões nesses dados. Sobre o sexo podemos afirmar que o número de mulheres reclamantes é `r "18,5%"` maior do que o de homens. Já sobre as idades, verifica-se que a faixa com mais reclamantes corresponde às idades de 21 a 40 anos, sendo essa observação independente do sexo. Para pessoas com idade superior a 40 anos, a proporção de reclamantes cai conforme a idade avança.

```{r, fig.cap = "Perfis dos reclamantes à SENACON com relação a sexo e idade. Fonte: SENACON."}
idades <- d %>% 
  ggplot(aes(x = faixa_etaria)) +
  geom_bar() +
  coord_flip() +
  theme_minimal() +
  scale_y_continuous(labels = function(y){y/1000}) +
  labs(y = "Contagem\n(em dezenas de milhares)", x = "Faixa etária")

sexo <- d %>% 
  mutate(sexo = ifelse(sexo == "M", "Masculino", "Feminino")) %>% 
  ggplot(aes(x = sexo)) +
  geom_bar() +
  theme_minimal() +
  scale_y_continuous(labels = function(y){y/1000}) +
  labs(y = "Contagem\n(em dezenas de milhares)", x = "Sexo")

idades_por_sexo <- d %>% 
  mutate(sexo = ifelse(sexo == "M", "Masculino", "Feminino")) %>% 
  ggplot(aes(x = faixa_etaria)) +
  geom_bar() +
  coord_flip() +
  facet_wrap(~sexo) +
  theme_minimal() +
  ggtitle("Distribuição de idades separada por sexo") +
  labs(y = "Contagem\n(em dezenas de milhares)", x = "Faixa etária") +
  scale_y_continuous(labels = function(y){y/1000}) 

gridExtra::grid.arrange(gridExtra::arrangeGrob(sexo, idades, ncol = 2),
                        idades_por_sexo,
                        ncol = 1,
                        nrow = 2)
```

### Maiores demandados no consumidor.gov

Pode-se verificar uma diferença entre o perfil das demandadas no portal consumidor.gov e o perfil das demandadas dos tribunais. Por um lado, similar ao que ocorre nos tribunais, os primeiros da lista de maiores demandadas do consumidor.gov são empresas de telecomunicações e bancos. Entretanto, as administradoras de cadastros de inadimplentes possuem maior representação no portal do que nos tribunais.

```{r, results = 'asis'}
library(tidyML)

d_2 <- d %>% 
  mutate(nome_fantasia = aggregate_major_companies(
    fix_nomes(nome_fantasia)))

d_2 %>% 
  count(nome_fantasia) %>% 
  arrange(desc(n)) %>% 
  mutate(p = n/sum(n),
         p_acum = cumsum(p),
         p = scales::percent(p),
         p_acum = scales::percent(p_acum)) %>% 
  head(30) %>% 
  knitr::knit_print(caption = "30 maiores demandadas da SENACON. Fonte: SENACON.")
```

### Eficácia da composição

Nesta seção exploramos a eficácia com que os conflitos apresentados às demandadas são resolvidos no próprio site. Um ponto bastante relevante foi o impacto da causa de pedir e da empresa demandada na negociação.

Similar ao realizado nas subseções anteriores, primeiro investigamos os padrões regionais que incidem sobre as negociações. Globalmente, a proporção de reclamações resolvidas é de 65.3%, mas ele varia entre 60.4%, no Rio de Janeiro e 73%, em Tocantins. 

```{r, fig.cap = "Proporção de casos resolvidos, dentre os avaliados pelo usuários, separados por unidade da federação. Fonte: SENACON."}
# mapa <- d %>% 
#   filter(avaliacao_reclamacao != "Não Avaliada") %>%
#   group_by(uf) %>% 
#   summarise(p = mean(avaliacao_reclamacao == "Resolvida", na.rm = T),
#             n = n()) %>% 
#   rename(id = uf) %>% 
#   inner_join(pnud_uf, by = 'id') %>% 
#   mutate(n = 100000*n/popt) %>% 
#   inner_join(br_uf_map, by = 'id') %>% {
#       ggplot(.) +
#         geom_map(aes(x = long, y = lat, map_id = id, fill = p),
#                  color = 'gray30', map = ., data = .) +
#         scale_fill_distiller(palette = 'PuRd', name = "Proporção de casos resolvidos", breaks = seq(0.6045,0.73, length.out = 5), labels = scales::percent) + 
#         coord_equal() +
#         theme_void() +
#         ggtitle("Proporção de casos resolvidos") 
#   } 
# 
# mapa
```
![Proporção de casos resolvidos, dentre os avaliados pelo usuários, separados por unidade da federação. Fonte: SENACON.](imgs/senacon_p_uf.pdf)

A proporção de casos resolvidos varia mais de acordo com a empresa demandada do que em função da unidade da federação. Comparando as taxas de resolução das reclamações por empresa, percebe-se, por exemplo, que as empresas de telecomunicações têm uma vantagem significativa sobre as instituições financeiras: a proporção de reclamações resolvidas por empresas de telecomunicações fica entre 70% e 80%, enquanto a mesma taxa para instituições financeiras fica em torno de 50%. As empresas com menor taxa de conversão são as concessionárias de serviços básicos, que conseguem apenas 25% de satisfação na avaliação dos usuários.

```{r, fig.cap = "Distribuição da proporção de casos resolvidos, separados por setor econômico. Fonte: SENACON.", fig.height=5}
d %>% 
  filter(avaliacao_reclamacao != "Não Avaliada") %>%
  group_by(area, nome_fantasia_2) %>% 
  summarise(p = mean(avaliacao_reclamacao == "Resolvida"),
            total = n()) %>%
  group_by(area) %>% 
  mutate(total_area = sum(total)) %>% 
  filter(total > 100, total_area > 1500) %>% 
  mutate(pmin = min(p),
         pmax = max(p),
         pmean = mean(p)) %>% 
  ungroup() %>% 
  mutate(area = fix_labels(area),
    area = forcats::fct_reorder(factor(area), pmean)) %>% 
  ggplot(aes(x = area, y = pmean, ymin = pmin, ymax = pmax)) +
  geom_errorbar() +
  geom_point(color = 'red', size = 1.5) + 
  coord_flip() +
  theme_bw() +
  theme(legend.position = 'none') +
  scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
  labs(y = '% de reclamações satisfeitas', x = 'Setor')
```

```{r}
data_set_telefonia_contra_bancos <- d %>%
  filter(avaliacao_reclamacao != "Não Avaliada") %>% 
  group_by(area, assunto) %>% 
  summarise(p = mean(avaliacao_reclamacao == "Resolvida"),
            total = n())

efetividade1 <-  scales::percent(mean(dplyr::filter(data_set_telefonia_contra_bancos, total > 1000, area == "telecomunicacoes")$p))
efetividade2 <- scales::percent(mean(dplyr::filter(data_set_telefonia_contra_bancos, total > 1000, area == "bancos_cartoes_financeiras")$p))
```

Essa vantagem se mantém inclusive se compararmos os processos pelos diferentes assuntos. Tomando apenas as instituições financeiras, as empresas de telefonia e assuntos com mais do que 1.000 reclamações, a média de efetividade de todos os assuntos em empresas de telecomunicações é `r "77,1%"`, enquanto o mesmo valor para instituições bancárias é `r "51%"`.

### Composição Extrajudicial e Litígios

Embora não fosse possível verificar diretamente se um litigante utilizou previamente alguma via de composição extrajudicial, pudemos comparar a quantidade de reclamações com a quantidade de litígios e obter uma cota superior para a busca por vias de composição extrajudicial. Os resultados da última subseção sugeriram que, dependendo da magnitude dessas cotas, é razoável acreditar que se mais demandantes procurassem o portal consumidor.gov antes de um litígio, menos processos consumeristas seriam ajuizados.

No Tribunal de Justiça do Rio Grande do Sul, por exemplo, os percentuais estimados de reclamantes que procuraram vias de composição extrajudicial são muito pequenos, ao passo que as taxas de eficiência são razoavelmente altas. Se, para fins de comparação, tomarmos apenas os processos contra a Oi, Vivo, Claro, Tim, Bradesco e Itaú, teremos o resultado que segue na tabela abaixo.

```{r contrafactual_senacon, results = 'asis'}
senacon_tjrs <- d %>% 
  filter(uf == "RS", avaliacao_reclamacao != "Não Avaliada") %>% 
  group_by(nome_fantasia_2) %>% 
  summarise(n = n(), ef = mean(avaliacao_reclamacao == "Resolvida")) 

d_tjrs_resumo <- readRDS('data-raw/resumo_rs.rds')

tjrs <- d_tjrs_resumo %>% 
  filter(mes > as.Date('2014-05-01')) %>%
  #comeco do consumidor.gov
  group_by(nome2) %>% 
  summarise(n = sum(n))

uniao_tjrs_senacon <- tjrs %>% 
  left_join(senacon_tjrs, by = c('nome2' = 'nome_fantasia_2')) %>% 
  mutate(p = n.y/n.x)

uniao_tjrs_senacon %>% 
  filter(nome2 %in% c("regex_oi", "regex_vivo", "regex_claro", "regex_tim", "regex_bradesco", "regex_itau")) %>% 
  select(nome2, n.x, ef, p) %>% 
  set_names("Empresa", "Número de processos", "Proporção de casos resolvidos", "% que consultou o site") %>% 
  knitr::knit_print(caption = "Proporção de casos resolvidos e percentual máximo de litigantes que consultaram o consumidor.gov para 6 empresas. Fonte: SENACON e Tribunal de Justiça do Rio Grande do Sul.")
```

Usando esses números para encenar o que aconteceria se todos os litigantes procurassem o portal da SENACON, os resultados parecem bem promissores. No que segue, simulamos alguns cenários com a finalidade de estimar quantos processos a menos entrariam no judiciário, caso a composição extrajudicial se efetivasse. 

Nas nossas simulações, adotamos algumas premissas. Os pontos abaixo impactam fortemente as nossas estimativas de ganho, por isso em alguns momentos empregamos posições bastante conversadoras. Fizemos isso com o intuito de produzir estimativas robustas.

As premissas foram:

1. Construímos a cota superior para o percentual de consumidores que consultam o consumidor.gov atualmente assumindo que todos os casos do consumidor.gov se tornaram processos, independente se o usuário declarou-se satisfeito. 
2. Se todos os litigantes tentassem a composição extrajudicial antes de litigar, a taxa de satisfação seria a mesma e, nos casos em que o litigante estivesse satisfeito, os litígios seriam evitados.

Tomando como exemplo os processos contra a empresa Oi, tem-se que no máximo 18% dos demandantes procuraram a SENACON para tentar composições extrajudiciais, ao passo que 60% dos reclamantes do site declaram-se satisfeitos. Pensando nisso, pode-se argumentar que, se num cenário hipotético todos os litigantes passassem a procurar vias de composição extrajudicial antes de entrar com os litígios, então o volume processual consumerista sobre a Oi diminuiria em 82% $\times$ 60% = 49,2%, assumindo que as taxas de conversão se mantivessem.

Aplicando o mesmo raciocínio aos dados da tabela \@ref{contrafactual_senacon}, obtém-se os resultados da tabela \@ref{resultados_finais}. O raciocínio para estimar cada ganho foi o mesmo utilizado no exemplo da Oi, mas aqui ainda consideramos três cenários:

1. **Pior cenário**: Se todos os processos tivessem passado pela SENACON, a taxa de satisfação cairia em 90%.
2. **Cenário médio**: Se todos os processos tivessem passado pela SENACON,  a taxa de satisfação cairia em 50%.
3. **Melhor cenário**: Se todos os processos tivessem passado pela SENACON,  a taxa de satisfação seria exatamente igual à taxa observada hoje.

```{r, results = 'asis'}
uniao_tjrs_senacon %>% 
  filter(nome2 %in% c("regex_oi", "regex_vivo", "regex_claro", "regex_tim", "regex_bradesco", "regex_itau")) %>% 
  mutate(ganho_pior_cenario = (1-p)*ef*0.1,
         ganho_cenario_medio = (1-p)*ef*0.5,
         ganho_melhor_cenario = (1-p)*ef) %>% 
  select(nome2, ef, p, ganho_pior_cenario, ganho_cenario_medio, ganho_melhor_cenario) %>% 
  set_names("Empresa", "% de satisfação", "% que consultou o site", "% Pior cenário",
            "% Cenário médio",
            "% Melhor cenário") %>%
    knitr::knit_print(caption = "Proporção de casos resolvidos e percentual máximo de litigantes que consultaram o consumidor.gov para 6 empresas, com estimativas de ganho no cenário em que as litigantes tentam conciliação antes de entrar com o processo. Fonte: SENACON.")
```

### Tempos

Considerando a discussão da última sessão, fez-se relevante calcular a celeridade e o número de reclamações efetivamente atendidas por cada litigante. Avaliar a eficiência do canal de composição extrajudicial da SENACON também envolve considerar o tempo com o qual as reclamações são resolvidas.

A média global do tempo de resposta de reclamações é de `r "6,69"` dias. Entretanto, como os segmentos bancários e de telefonia são usualmente os mais expressivos na justiça consumerista, vamos nos ater a calcular os tempos médios para esses segmentos. 

```{r}
data_set_telefonia_contra_bancos <- d %>%
  filter(avaliacao_reclamacao != "Não Avaliada") %>% 
  group_by(area, assunto) %>% 
  summarise(p = mean(avaliacao_reclamacao == "Resolvida"),
            total = n(),
            tempo_medio = mean(tempo_reposta, na.rm = T))
tempo_medio1 <- round(mean(dplyr::filter(data_set_telefonia_contra_bancos, total > 1000, area == "bancos_cartoes_financeiras")$tempo_medio, na.rm = T), 2)
tempo_medio2 <- round(mean(dplyr::filter(data_set_telefonia_contra_bancos, total > 1000, area == "telecomunicacoes")$tempo_medio, na.rm = T), 2)
```

Realizando um procedimento similar ao procedimento da última sessão, tomamos a média dos tempos médios de todos os tempos de processos de telefonia e bancos separados pelos assuntos, com mais de 1000 observações. Dessa forma, concluímos que os bancos levam, em média `r "7,04"` dias para responder as demandas, enquanto as empresas de telecomunicações levam, em média  `r "7,35"`.
